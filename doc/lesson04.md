<article class="markdown-body entry-content container-lg" itemprop="text">
    <h1>
        <a id="user-content-онлайн-проект-topjava" class="anchor" aria-hidden="true" href="#онлайн-проект-topjava">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Онлайн-проект <a href="https://github.com/JavaWebinar/topjava">Topjava</a>
    </h1>
    <h2>
        <a id="user-content-материалы-занятия" class="anchor" aria-hidden="true" href="#материалы-занятия">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a href="https://drive.google.com/open?id=0B9Ye2auQ_NsFfkxqbVpwZUd5anQ2TXE4bm5HbXhtVmkxMUxFSjhNQ1hXYVVTTTZEMzkzN2s" rel="nofollow">Материалы занятия</a>
    </h2>
    <h3>
        <a id="user-content--правки-в-проекте" class="anchor" aria-hidden="true" href="#-правки-в-проекте">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672935/ef09ec1e-e6e7-11e5-9f79-d1641c05cbe6.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672935/ef09ec1e-e6e7-11e5-9f79-d1641c05cbe6.png" alt="correction" style="max-width:100%;"></a> Правки в проекте
    </h3>
    <h4>
        <a id="user-content-apply-4_0_fixpatch" class="anchor" aria-hidden="true" href="#apply-4_0_fixpatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Apply 4_0_fix.patch
    </h4>
    <blockquote>
        <p>Фикс имени переменной и счетчика для возможных тестов</p>
    </blockquote>
    <h2>
        <a id="user-content--разбор-домашнего-задания-hw3" class="anchor" aria-hidden="true" href="#-разбор-домашнего-задания-hw3">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672719/09593080-e6e7-11e5-81d1-5cb629c438ca.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672719/09593080-e6e7-11e5-81d1-5cb629c438ca.png" alt="hw" style="max-width:100%;"></a> Разбор домашнего задания HW3
    </h2>
    <blockquote>
        <p><code>SpringMain, InMemoryAdminRestControllerTest, InMemoryAdminRestControllerSpringTest</code> починим в патче <strong>4_7_create_inmemory_test_ctx.patch (видео 4)</strong></p>
    </blockquote>
    <h3>
        <a id="user-content--1-hw03-meals--jdbcmealrepository" class="anchor" aria-hidden="true" href="#-1-hw03-meals--jdbcmealrepository">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 1. <a href="https://drive.google.com/file/d/1_IIYBP5l2aHxHaY_j1bqFWj1maACvNpa" rel="nofollow">HW03: meals + JdbcMealRepository</a>
    </h3>
    <ul>
        <li><a href="https://ru.wikipedia.org/wiki/%D0%98%D0%BD%D0%B4%D0%B5%D0%BA%D1%81_(%D0%B1%D0%B0%D0%B7%D1%8B_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85)#%D0%9F%D0%BE%D1%81%D0%BB%D0%B5%D0%B4%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE%D1%81%D1%82%D1%8C_%D1%81%D1%82%D0%BE%D0%BB%D0%B1%D1%86%D0%BE%D0%B2_%D0%B2_%D1%81%D0%BE%D1%81%D1%82%D0%B0%D0%B2%D0%BD%D0%BE%D0%BC_%D0%B8%D0%BD%D0%B4%D0%B5%D0%BA%D1%81%D0%B5" rel="nofollow">Последовательность столбцов в составном индексе</a></li>
        <li>Дополнительно: для <code>JdbcMealRepository.save</code> можно использовать <a href="https://stackoverflow.com/questions/13339171/548473" rel="nofollow">CombinedSqlParameterSource</a></li>
        <li>В ответе на <a href="https://stackoverflow.com/questions/3639861" rel="nofollow">Why is SELECT * considered harmful?</a> есть случаи, когда она допустима (наш случай): <code>when "*" means "a row"</code></li>
    </ul>
    <h4>
        <a id="user-content-apply-4_1_hw3patch" class="anchor" aria-hidden="true" href="#apply-4_1_hw3patch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <strong>Apply 4_1_HW3.patch</strong>
    </h4>
    <h3>
        <a id="user-content-сравнение-времени-выполнения-для-разных-индексов" class="anchor" aria-hidden="true" href="#сравнение-времени-выполнения-для-разных-индексов">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a href="/JavaWebinar/topjava/blob/doc/doc/meals_index.md">Сравнение времени выполнения для разных индексов</a>
    </h3>
    <ul>
        <li><a href="http://stackoverflow.com/questions/970562/postgres-and-indexes-on-foreign-keys-and-primary-keys" rel="nofollow">На id как на primary key индекс создается автоматически</a></li>
        <li>Все запросы в таблицу meals у нас идут с <code>user_id</code></li>
        <li>По полю <code>date_time</code> не только есть запросы, но и сортируем результат. То есть это поле - хороший кандидат для индексирования</li>
        <li>Следует иметь в виду, что индексы ускоряют операции чтения, но замедляют вставку и удаление. Поэтому необходим анализ в реальном приложении</li>
        <li><a href="https://habrahabr.ru/post/203320/" rel="nofollow">Оптимизация запросов. Основы EXPLAIN в PostgreSQL</a></li>
        <li><a href="https://habrahabr.ru/post/203386/" rel="nofollow">Оптимизация запросов. Часть 2</a></li>
        <li><a href="https://habrahabr.ru/post/203484/" rel="nofollow">Оптимизация запросов. Часть 3</a></li>
        <li><a href="https://postgrespro.ru/docs/postgresql/9.6/indexes.html" rel="nofollow">Документация Postgres: индексы</a></li>
    </ul>
    <h2>
        <a id="user-content--разбор-домашнего-задания-hw3-1" class="anchor" aria-hidden="true" href="#-разбор-домашнего-задания-hw3-1">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672719/09593080-e6e7-11e5-81d1-5cb629c438ca.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672719/09593080-e6e7-11e5-81d1-5cb629c438ca.png" alt="hw" style="max-width:100%;"></a> Разбор домашнего задания HW3
    </h2>
    <h3>
        <a id="user-content--2-hw03-optional-meals-tests" class="anchor" aria-hidden="true" href="#-2-hw03-optional-meals-tests">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 2. <a href="https://drive.google.com/file/d/1RfO0Irz8ayw2ivnjffUol20BQrKpu-jg" rel="nofollow">HW03 Optional: Meals tests</a>
    </h3>
    <h4>
        <a id="user-content-apply-4_2_hw3_optionalpatch" class="anchor" aria-hidden="true" href="#apply-4_2_hw3_optionalpatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <strong>Apply 4_2_HW3_optional.patch</strong>
    </h4>
    <blockquote>
        <p>Убрал <code>throws Exception</code> из тестов. IDEA по умолчанию перестала их добавлять.
            В <code>MealServiceTest.updateNotOwn</code> добавил дополнительную проверку, что еда в тесте не модифицировалась.
        </p>
    </blockquote>
    <h4>
        <a id="user-content-apply-4_3_tests_refactoringpatch" class="anchor" aria-hidden="true" href="#apply-4_3_tests_refactoringpatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <strong>Apply 4_3_tests_refactoring.patch</strong>
    </h4>
    <blockquote>
        <ul>
            <li>Переименовал статический метод генерации (<a href="http://javaops.ru/view/books" rel="nofollow">Блох Джошуа, "Java. Эффективное программирование."</a>) на <code>usingIgnoringFieldsComparator</code>.</li>
        </ul>
    </blockquote>
    <h4>
        <a id="user-content-apply-4_4_hw3_fix_loggingpatch" class="anchor" aria-hidden="true" href="#apply-4_4_hw3_fix_loggingpatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <strong>Apply 4_4_HW3_fix_logging.patch</strong>
    </h4>
    <ul>
        <li><a href="https://stackoverflow.com/a/27296470/548473" rel="nofollow">Вызов статического метода из конфигурации спринга</a></li>
    </ul>
    <h2>
        <a id="user-content-занятие-4" class="anchor" aria-hidden="true" href="#занятие-4">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Занятие 4:
    </h2>
    <h3>
        <a id="user-content--3-методы-улучшения-качества-кода" class="anchor" aria-hidden="true" href="#-3-методы-улучшения-качества-кода">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 3. <a href="https://drive.google.com/open?id=0B9Ye2auQ_NsFU005ZzBNZmZnTVU" rel="nofollow">Методы улучшения качества кода</a>
    </h3>
    <ul>
        <li>
            Добавьте в своем <code>readme.md</code> сверху две строчки <code>Codacy Badge</code> и <code>Build Status</code>, по аналогии с моим <a href="https://github.com/JavaWebinar/topjava/blob/master/README.md">README.md</a> (<a href="https://raw.githubusercontent.com/JavaWebinar/topjava/master/README.md" rel="nofollow">Raw</a>). <code>Codacy Badge</code> берется с сайта <code>codacy -&gt; Settings</code>
            <ul>
                <li>
                    <a href="https://www.codacy.com" rel="nofollow">Codacy Check code</a> (проверка стиля и поиск багов в коде).
                    <ul>
                        <li>добавил <a href="https://support.codacy.com/hc/en-us/articles/360005097654-Ignore-files-from-Codacy-analysis" rel="nofollow">Codacy configuration file</a> для исключения из проверок содержимого <code>webapp</code> и <code>READ.me</code> (на нашем проекте он выдает на них кучу ошибок)</li>
                        <li>после правок паттернов можно сделать <a href="https://support.codacy.com/hc/en-us/articles/213840489-How-do-I-reanalyze-my-project-" rel="nofollow">повторный анализ</a>. С результатами тормозит</li>
                    </ul>
                </li>
                <li>
                    <a href="https://travis-ci.com/" rel="nofollow">Сборку и тесты Travis</a> (результат выполнения тестов проекта)
                    <ul>
                        <li><a href="https://habr.com/post/140344/" rel="nofollow">Что такое travis-ci</a></li>
                        <li><a href="https://dzone.com/articles/travis-ci-tutorial-java-projects" rel="nofollow">Travis CI Tutorial</a></li>
                        <li><a href="https://docs.travis-ci.com/user/languages/java/" rel="nofollow">Сборка Java проекта</a></li>
                    </ul>
                </li>
                <li>Сервис по проверке <code>maven</code> зависимостей VersionEye <a href="https://blog.versioneye.com/2017/10/26/the-start-of-a-new-journey" rel="nofollow">закрыли</a>. Ищу замену...</li>
            </ul>
        </li>
    </ul>
    <h4>
        <a id="user-content-сделайте-push-для-отображения-результатов-текущего-состояния-проекта" class="anchor" aria-hidden="true" href="#сделайте-push-для-отображения-результатов-текущего-состояния-проекта">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Сделайте <code>push</code> для отображения результатов текущего состояния проекта.
    </h4>
    <h4>
        <a id="user-content-apply-4_5_improve_codepatch" class="anchor" aria-hidden="true" href="#apply-4_5_improve_codepatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <strong>Apply 4_5_improve_code.patch</strong>
    </h4>
    <blockquote>
        <ul>
            <li>Добавил проверки предусловий <code>Assert.notNull</code> в сервисы</li>
            <li>Добавил конфигурацию <code>.travis.yml</code> и <code>.codacy.yml</code></li>
            <li>Ввел удобный метод <code>AbstractBaseEntity.id()</code></li>
        </ul>
    </blockquote>
    <ul>
        <li><a href="https://ru.wikipedia.org/wiki/Контрактное_программирование" rel="nofollow">Контрактное программирование</a>, <a href="http://neerc.ifmo.ru/wiki/index.php?title=Программирование_по_контракту" rel="nofollow">Программирование по контракту</a></li>
        <li><a href="https://www.sw-engineering-candies.com/blog-1/comparison-of-ways-to-check-preconditions-in-java" rel="nofollow">Comparison Preconditions in Java</a></li>
        <li>
            IDEA Settings -&gt; Plugins -&gt; Browse repositories... Add <a href="https://qaplug.com/about/" rel="nofollow">QAPlug: PMD/FindBugs/Checkstyle/Hammurapi</a>
            <ul>
                <li>Tools -&gt; QAPlug -&gt; Analyze Code...</li>
            </ul>
        </li>
        <li>IDEA <a href="https://www.jetbrains.com/help/idea/running-inspections.html" rel="nofollow">Analyze | Inspect Code</a></li>
    </ul>
    <h3>
        <a id="user-content--4-spring-инициализация-и-популирование-db" class="anchor" aria-hidden="true" href="#-4-spring-инициализация-и-популирование-db">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 4. <a href="https://drive.google.com/open?id=1faq0dtek-RcBENfISkod35PGU5jcuOsB" rel="nofollow">Spring: инициализация и популирование DB</a>
    </h3>
    <h4>
        <a id="user-content-apply-4_6_init_and_populate_dbpatch" class="anchor" aria-hidden="true" href="#apply-4_6_init_and_populate_dbpatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <strong>Apply 4_6_init_and_populate_db.patch</strong>
    </h4>
    <ul>
        <li><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#jdbc-initializing-datasource-xml" rel="nofollow">Инициализация базы при старте приложения</a></li>
    </ul>
    <h3>
        <a id="user-content--5-подмена-контекста-при-тестировании" class="anchor" aria-hidden="true" href="#-5-подмена-контекста-при-тестировании">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 5. <a href="https://drive.google.com/open?id=0B9Ye2auQ_NsFNTNWV04weDBGSmc" rel="nofollow">Подмена контекста при тестировании</a>
    </h3>
    <h4>
        <a id="user-content-apply-4_7_create_inmemory_test_ctxpatch" class="anchor" aria-hidden="true" href="#apply-4_7_create_inmemory_test_ctxpatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <strong>Apply 4_7_create_inmemory_test_ctx.patch</strong>
    </h4>
    <blockquote>
        <p>Переименовал <code>mock.xml</code> в <code>inmemory.xml</code></p>
    </blockquote>
    <h3>
        <a id="user-content--6-orm-hibernate-jpa" class="anchor" aria-hidden="true" href="#-6-orm-hibernate-jpa">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 6. <a href="https://drive.google.com/open?id=0B9Ye2auQ_NsFVWZYcHoyUF9qX2M" rel="nofollow">ORM. Hibernate. JPA.</a>
    </h3>
    <p><a href="https://en.wikipedia.org/wiki/Entity%E2%80%93relationship_model" rel="nofollow">Entity</a>- класс (объект Java), который в ORM маппится в таблицу DB.</p>
    <p><a href="https://jsehelper.blogspot.com/2016/04/java-persistence-api-jpa-2.html" rel="nofollow">EntityManager</a> - это по сути прокси-обертка над Hibernate Session, которая создается каждый раз при открытии транзакции.</p>
    <blockquote>
        <ul>
            <li>ВНИМАНИЕ: патч меняет <code>postgres.properties</code>, в котором у вас, возможно, свои креденшелы к базе</li>
            <li>
                <code>hibernate-core</code> с 5.2.x включает <code>hibernate-entitymanager</code> и <code>hibernate-java8</code>, то есть конверторы Time API уже не нужны
                <ul>
                    <li><a href="http://stackoverflow.com/questions/23718383/jpa-support-for-java-8-new-date-and-time-api" rel="nofollow">JPA support for Java 8 new date and time API</a></li>
                    <li><a href="http://stackoverflow.com/questions/31965179/whats-new-in-hibernate-5" rel="nofollow">What's new in Hibernate 5?</a></li>
                    <li><a href="http://stackoverflow.com/a/33001846/548473" rel="nofollow">JPA support for Java 8 new date and time API</a></li>
                </ul>
            </li>
            <li><a href="http://hibernate.org/validator/documentation/getting-started/#unified-expression-language-el" rel="nofollow">EL implementation provided by the container. In a Java SE you have to add an implementation as dependency to your POM file</a>: добавил <code>javax.el</code> зависимость со <code>scope=provided</code></li>
        </ul>
    </blockquote>
    <h4>
        <a id="user-content-apply-4_8_add_jpapatch" class="anchor" aria-hidden="true" href="#apply-4_8_add_jpapatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <strong>Apply 4_8_add_jpa.patch</strong>
    </h4>
    <blockquote>
        <ul>
            <li><strong><a href="https://github.com/JavaOPs/topjava/wiki/IDEA#jpa">Настройка JPA в IDEA</a>.<br>
                ПРОВЕРЬТЕ, что у вас не подтянулись Java EE 6 libraries, все зависимости в проект попадают только через Maven. Перед настройкой сначала подтяните его зависимости</strong>
            </li>
            <li>Тесты и приложение ломаются. <code>MealServiceTest</code> починится после выполнения HW04 (<code>JpaMealRepository</code>)</li>
            <li>Если вы используете Java 9 и выше, то возникают проблемы с <code>JAXBException</code> (пакет <code>java.xml.bind</code>). <a href="https://www.concretepage.com/forum/thread?qid=531" rel="nofollow">См. решение</a></li>
            <li>Обратите внимание на пакет с аннотациями валидации: в новой версии <code>javax</code> поменялся на <code>jakarta</code></li>
        </ul>
    </blockquote>
    <ul>
        <li>
            Дополнительно:
            <ul>
                <li><a href="http://ru.wikipedia.org/wiki/ORM" rel="nofollow">ORM</a></li>
                <li><a href="http://habrahabr.ru/post/265061/" rel="nofollow">JPA и Hibernate в вопросах и ответах</a></li>
                <li><a href="https://habr.com/ru/post/416851/" rel="nofollow">Hibernate — о чем молчат туториалы</a></li>
                <li><a href="https://habrahabr.ru/post/337488/" rel="nofollow">Наследование в Hibernate: выбор стратегии</a></li>
                <li>
                    <a href="https://easyjava.ru/data/jpa/jpa-entitymanager-upravlyaem-sushhnostyami/" rel="nofollow">JPA EntityManager: управляем сущностями</a>
                    <ul>
                        <li><a href="http://stackoverflow.com/a/6084701/548473" rel="nofollow">Field vs property access</a></li>
                        <li><a href="http://www.quizful.net/post/Hibernate-3-introduction-and-writing-hello-world-application" rel="nofollow">Hibernate: введение и написания Hello world приложения</a></li>
                        <li><a href="https://habiletechnologies.com/blog/reasons-to-choose-hibernate-over-jdbc" rel="nofollow">15 reasons why we need to choose Hibernate over JDBC</a></li>
                        <li><a href="http://en.wikibooks.org/wiki/Java_Persistence/Mapping" rel="nofollow">Mapping: описание модели Hibernate (hbm.xml/annotation)</a>.</li>
                        <li><a href="https://ru.wikipedia.org/wiki/Hibernate_(библиотека)" rel="nofollow">Hibernate</a>. Другие ORM: <a href="http://en.wikipedia.org/wiki/TopLink" rel="nofollow">TopLink</a>, <a href="http://en.wikipedia.org/wiki/EclipseLink" rel="nofollow">EсlipseLink</a>, <a href="http://en.wikipedia.org/wiki/Ebean" rel="nofollow">EBean</a> (<a href="http://www.playframework.com/documentation/2.2.x/JavaEbean" rel="nofollow">used in Playframework</a>).</li>
                        <li><a href="http://ru.wikipedia.org/wiki/Java_Persistence_API" rel="nofollow">JPA (wiki)</a>. <a href="https://en.wikipedia.org/wiki/Java_Persistence_API" rel="nofollow">JPA (english wiki)</a>. <a href="http://www.jpab.org/All/All/All.html" rel="nofollow">JPA Performance Benchmark</a></li>
                        <li><a href="http://en.wikibooks.org/wiki/Java_Persistence/Identity_and_Sequencing" rel="nofollow">Стратегии генерации PK</a></li>
                        <li><a href="http://validator.hibernate.org" rel="nofollow">hibernate-validator</a>. <a href="http://stackoverflow.com/questions/14730329/jpa-2-0-exception-to-use-javax-validation-package-in-jpa-2-0" rel="nofollow">JSR-303 -&gt; JSR-349</a></li>
                        <li><a href="https://web.archive.org/web/20170514002949/http://java.devcolibri.com:80/post/15" rel="nofollow">Описание связей в модели. Ленивая загрузка объекта.</a></li>
                        <li><a href="http://docs.jboss.org/hibernate/entitymanager/3.6/reference/en/html/architecture.html#d0e61" rel="nofollow">JPA definitions</a></li>
                        <li><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#expressions" rel="nofollow">Spring expressions: выражения в конфигурации</a></li>
                        <li><a href="https://proselyte.net/tutorials/hibernate-tutorial/hibernate-query-language/" rel="nofollow">HQL</a>/ <a href="http://ru.wikipedia.org/wiki/Java_Persistence_Query_Language" rel="nofollow">JPQL</a>.</li>
                        <li>Динамические запросы (которые формируются в коде): <a href="http://www.objectdb.com/java/jpa/query/criteria" rel="nofollow">JPA Criteria API</a>. <a href="http://www.querydsl.com/" rel="nofollow">Unified Queries for Java</a></li>
                        <li><a href="https://web.archive.org/web/20170608194049/https://bitbucket.org/montanajava/jpaattributeconverters" rel="nofollow">Using the Java 8 Date Time Classes with JPA</a></li>
                    </ul>
                </li>
            </ul>
        </li>
    </ul>
    <h4>
        <a id="user-content-apply-4_9_add_named_query_and_transactionpatch" class="anchor" aria-hidden="true" href="#apply-4_9_add_named_query_and_transactionpatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <strong>Apply 4_9_add_named_query_and_transaction.patch</strong>
    </h4>
    <blockquote>
        <p>Чтобы посмотреть информацию о транзакциях (открытие/закрытие и пр.), можно выставить в конфигурации logback
            <code>&lt;logger name="org.springframework.orm.jpa.JpaTransactionManager" level="debug"/&gt;</code>
        </p>
    </blockquote>
    <ul>
        <li><a href="http://ru.wikipedia.org/wiki/Транзакция_(информатика)" rel="nofollow">Транзакция. ACID. Уровни изоляции транзакций.</a></li>
        <li><a href="http://www.tutorialspoint.com/spring/spring_transaction_management.htm" rel="nofollow">Spring Transaction Management</a></li>
        <li><a href="http://habrahabr.ru/post/232381/" rel="nofollow"><code>@Transactional</code> в тестах. Настройка EntityManagerFactory</a></li>
    </ul>
    <blockquote>
        <p><a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672858/9cd58692-e6e7-11e5-905d-c295d2a456f1.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672858/9cd58692-e6e7-11e5-905d-c295d2a456f1.png" alt="question" style="max-width:100%;"></a>  Зачем надо начинать транзакцию, если речь идет только о чтении данных? Начало транзакции при выполнении операции чтения всего лишь добавит лишних накладных расходов
            (см. <a href="https://www.ibm.com/developerworks/ru/library/j-ts1/index.html" rel="nofollow">Стратегии работы с транзакциями, pаспространенные ошибки</a>)
        </p>
    </blockquote>
    <p>Вот ответ от Oliver Drotbohm, автора Spring-Data на предложение работать без транзакций для операций чтения (<code>propagation=Propagation.SUPPORTS</code>): <a href="https://jira.spring.io/browse/DATAJPA-601" rel="nofollow">Improve performance with Propagation.SUPPORTS for readOnly operation</a>. Коротко:</p>
    <ul>
        <li>Статья устаревшая и неверно упрощает многие вещи. Есть множество вещей, которые влияют на производительность</li>
        <li>Без транзакции не будет оптимизации по флагу <code>readOnly</code> при выполнении JDBC и в управлении ресурсами Spring's JPA (в том числе выключение <code>flush</code>)
            См. <a href="https://developer.jboss.org/wiki/Non-transactionalDataAccessAndTheAuto-commitMode" rel="nofollow">Non-transactional data access and the auto-commit mode</a>
        </li>
    </ul>
    <p>Справочник:</p>
    <ul>
        <li><a href="https://www.youtube.com/watch?v=dFASbaIG-UU" rel="nofollow">Видео: Вячеслав Круглов — Как начинающему Java-разработчику подружиться со своей базой данных?</a></li>
        <li><a href="http://www.youtube.com/watch?v=YzOTZTt-PR0" rel="nofollow">Видео: Николай Алименков — Босиком по граблям Hibernate</a></li>
        <li><a href="https://www.youtube.com/watch?v=b52Qz6qlic0" rel="nofollow">Видео: Николай Алименков — Сделаем Hibernate снова быстрым</a></li>
        <li><a href="https://www.ibm.com/developerworks/ru/library/j-ts2/" rel="nofollow">Стратегии работы с транзакциями</a></li>
        <li><a href="https://easyjava.ru/tag/jpa/" rel="nofollow">Примеры работы с JPA</a></li>
        <li><a href="http://www.byteslounge.com/tutorials/spring-transaction-propagation-tutorial" rel="nofollow">Spring transaction propagation tutorial</a></li>
        <li><a href="https://dzone.com/refcardz/getting-started-with-jpa" rel="nofollow">Getting Started with JPA</a></li>
        <li><a href="http://en.wikibooks.org/wiki/Java_Persistence" rel="nofollow">Java Persistence</a></li>
        <li><a href="https://easyjava.ru/category/data/jpa/" rel="nofollow">Разделы по Java Persistence API</a></li>
        <li><a href="http://docs.spring.io/spring-framework/docs/4.0.x/spring-framework-reference/html/transaction.html" rel="nofollow">Spring Framework transaction management</a></li>
        <li><a href="http://www.baeldung.com/persistence-with-spring-series/" rel="nofollow">Spring Persistence Tutorial</a></li>
        <li><a href="http://www.objectdb.com/java/jpa/persistence/managed#Entity_Object_Life_Cycle" rel="nofollow">Working with JPA Entity Objects</a></li>
        <li><a href="http://www.ibm.com/developerworks/ru/library/j-ts1/" rel="nofollow">Стратегии работы с транзакциями: Распространенные ошибки</a></li>
        <li><a href="http://habrahabr.ru/post/208400/" rel="nofollow">Принципы работы СУБД. MVCC</a></li>
        <li><a href="https://ru.wikipedia.org/wiki/MVCC" rel="nofollow">MVCC</a></li>
    </ul>
    <h3>
        <a id="user-content--7-добавляем-поддержку-hsqldb" class="anchor" aria-hidden="true" href="#-7-добавляем-поддержку-hsqldb">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 7. <a href="https://drive.google.com/open?id=0B9Ye2auQ_NsFSTJEQ1Rvd3Jvc2c" rel="nofollow">Добавляем поддержку HSQLDB</a>
    </h3>
    <h4>
        <a id="user-content-apply-4_10_add_hsqldbpatch" class="anchor" aria-hidden="true" href="#apply-4_10_add_hsqldbpatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <strong>Apply 4_10_add_hsqldb.patch</strong>
    </h4>
    <blockquote>
        <ul>
            <li>Переделал <code>jdbc.initLocation</code>: IDEA не "тупит", если путь к скрипту полностью прописывать в пропертях.</li>
        </ul>
    </blockquote>
    <h2>
        <a id="user-content--ваши-вопросы" class="anchor" aria-hidden="true" href="#-ваши-вопросы">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672858/9cd58692-e6e7-11e5-905d-c295d2a456f1.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672858/9cd58692-e6e7-11e5-905d-c295d2a456f1.png" alt="question" style="max-width:100%;"></a> Ваши вопросы
    </h2>
    <blockquote>
        <p>Есть несколько аналогичных "встроенных" баз данных. H2, HSQLDB, Derby, SQLite. Почему был выбран HSQLDB?</p>
    </blockquote>
    <p>Просто с ней приходилось работать. HSQLDB и H2 наиболее популярны. В новом курсе по spring-boot планирую использовать H2.
        Здесь интересное краткое описание <a href="http://easyjava.ru/data/vstraivaemye-bazy-dannyx-v-java/" rel="nofollow">встраиваемых баз данных в Java</a>.
        В HSQLDB нет репликаций, кластеризации и объем данным ограничен несколькими TB. Для большого количества приложений она подходит и для продакшена. См.
    </p>
    <ul>
        <li><a href="http://stackoverflow.com/questions/4152911/what-is-hsqldb-limitations" rel="nofollow">What is HSQLDB limitations?</a></li>
        <li><a href="https://habrahabr.ru/sandbox/23199/" rel="nofollow">HSQLDB в режиме in-process</a></li>
    </ul>
    <blockquote>
        <p>Чистого JPA не существует, т. е. это всего лишь интерфейс, спецификация? Говорим JPA, подразумеваем какой-то ORM фрэймворк? А что тогда используют чистый jdbc, Spring-jdbc, MyBatis? MyBatis не реализует JPA?</p>
    </blockquote>
    <p><a href="https://ru.wikipedia.org/wiki/ORM" rel="nofollow">ORM</a> это технология связывания БД и объектов приложения, а <a href="https://ru.wikipedia.org/wiki/Java_Persistence_API" rel="nofollow">JPA</a> - это JavaEE спецификация (API) этой технологии.
        Реализации JPA - Hibernate, OpenJPA, EclipceLink, но, например, Hibernate может работать по собственному API (без JPA, которая появилась позже). Spring-JDBC, MyBatis, JDBI не реализуют JPA - это обертки к JDBC. Все ORM и JPA также реализованы поверх JDBC.
    </p>
    <blockquote>
        <p>В зависимостях maven <code>hibernate-entitymanager</code> тянет за собой <code>jboss-logging</code>. Как будет происходить логирование?</p>
    </blockquote>
    <p><a href="http://stackoverflow.com/questions/11639997/how-do-you-configure-logging-in-hibernate-4-to-use-slf4j" rel="nofollow">How do you configure logging in Hibernate 4 to use SLF4J</a>: в нашем проекте автоматически подхватывается <code>logback-classic</code>.</p>
    <blockquote>
        <p>В чем преимущество Hibernate?</p>
    </blockquote>
    <p>Hibernate (как любая ORM) реализует мапинг таблиц в объекты Java. Когда мы добавим роли пользователю, вы увидите, насколько код будет проще, чем в jdbc. Также см. <a href="https://www.sitepoint.com/5-reasons-to-use-jpa-hibernate/" rel="nofollow">5 Reasons to Use JPA / Hibernate</a></p>
    <blockquote>
        <p>Чем отличается <code>@Column(nullable = false)</code>  от  <code>@NotNull</code> и есть ли необходимость указывать обе аннотации ?</p>
    </blockquote>
    <p><code>@Column(nullable = false)</code> - это атрибуты колонки таблицы базы. <code>@NotNull</code> - это валидация, которая происходит в приложении перед вставкой в базу. Если колонка ненулевая, то <code>NOT NULL</code> обязательна. Валидация опциональна. Также см.
        <a href="http://stackoverflow.com/questions/7439504/" rel="nofollow">@NotNull vs @Column(nullable = false)</a>
    </p>
    <blockquote>
        <p>почему мы в бине <code>entityManagerFactory</code> не указали диалект базы данных?</p>
    </blockquote>
    <p>Он <a href="http://stackoverflow.com/a/39817822/548473" rel="nofollow">автоматически определяется из <code>DataSource</code> драйвера</a></p>
    <blockquote>
        <p>В чем разница между <code>persist</code> и <code>merge</code></p>
    </blockquote>
    <p><a href="http://stackoverflow.com/questions/1069992/jpa-entitymanager-why-use-persist-over-merge" rel="nofollow">Подробный ответ со Stackoverflow</a> с объяснением разницы. Упрощенно:</p>
    <ul>
        <li><code>merge</code>, в отличие от <code>persist</code>, делает запрос в базу данных, если entity нет в текущей сессии</li>
        <li>entity, переданный в <code>merge</code>, не меняется. Нужно использовать возвращаемый результат</li>
    </ul>
    <blockquote>
        <p><code>em.merge</code> при отсутствии старой записи (несуществующий <code>id</code>) создает новую. Т. е. в <code>JpaUserRepository</code> нарушается логика</p>
    </blockquote>
    <p>В Hibernate есть такая бага: <a href="https://hibernate.atlassian.net/browse/HHH-1661" rel="nofollow">https://hibernate.atlassian.net/browse/HHH-1661</a>, <a href="https://stackoverflow.com/questions/34249483" rel="nofollow">https://stackoverflow.com/questions/34249483</a></p>
    <ul>
        <li><a href="https://stackoverflow.com/questions/34249483" rel="nofollow">Hibernate unexpectedly issues INSERT instead of throwing the javax.persistence.OptimisticLockException, when a nonexistent entity is passed to merge()</a></li>
        <li><a href="https://stackoverflow.com/questions/21489300" rel="nofollow">Should Hibernate Session#merge do an insert when receiving an entity with an ID?</a></li>
    </ul>
    <p>Если это действительно наш критичный бизнес-кейс (например, с многопоточным удалением entity), то нужно искать варианты обходного решения.
        Если это не бизнес-кейс (попытка поломать или ошибка UI), то оставляем как есть (обычно на практике не парятся).
    </p>
    <blockquote>
        <p>Почему в проекте транзакционность сделана в слое репозитория, а не сервиса? Транзакциями удобнее пользоваться на слое сервисов, так как здесь  реализуется бизнес логика и бывает нужно делать несколько операций в одной транзакции.</p>
    </blockquote>
    <p>С классической точки зрения все транзакции действительно объявляются на уровне сервиса. Мы будем использовать в логике сервиса несколько запросов и тогда сделаем дополнительную транзакцию на методе сервисе. Новая транзакция при этом не создается (по умолчанию используется <code>Propagation.REQUIRED</code>, который поддерживают существующую), поэтому несколько <code>@Transactional</code> аннотаций ведут себя как одна. Я использую подход <code>spring-data-jpa</code> (будет на следующем занятии): в репозитории транзакции объявлять удобно, тк не надо думать о них в сервисах.</p>
    <h4>
        <a id="user-content-apply-4_11_fix_validationpatch" class="anchor" aria-hidden="true" href="#apply-4_11_fix_validationpatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <strong>Apply 4_11_fix_validation.patch</strong>
    </h4>
    <p>При создании/обновлении User с пустыми полями проверки <code>@NotBlank</code> от <code>jakarta</code> не работают. Вернул <code>javax (hibernate-validator 6.x)</code>.
        Примените патч и после него не забудьте сделать <code>mvn clean</code> и <code>Reload All Maven Projects</code>
    </p>
    <hr>
    <h2>
        <a id="user-content--домашнее-задание-hw4" class="anchor" aria-hidden="true" href="#-домашнее-задание-hw4">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672719/09593080-e6e7-11e5-81d1-5cb629c438ca.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672719/09593080-e6e7-11e5-81d1-5cb629c438ca.png" alt="hw" style="max-width:100%;"></a> Домашнее задание HW4
    </h2>
    <ul>
        <li>
            1: Сделать из <code>Meal</code> Hibernate entity
            <ul>
                <li><a href="http://stackoverflow.com/questions/17137307" rel="nofollow">Hibernate Validator: @NotNull, @NotEmpty, @NotBlank</a></li>
                <li><a href="https://en.wikibooks.org/wiki/Java_Persistence/ManyToOne" rel="nofollow">Реализация ManyToOne</a></li>
            </ul>
        </li>
        <li>2: Имплементировать и протестировать <code>JpaMealRepository</code>. Проверьте, нет ли в запросах ненужных данный (лишних <code>JOIN</code>)</li>
    </ul>
    <h3>
        <a id="user-content-optional" class="anchor" aria-hidden="true" href="#optional">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Optional
    </h3>
    <ul>
        <li>
            3: Добавить в тесты <code>MealServiceTest</code> функциональность <code>@Rule</code>:
            <ul>
                <li>3.1: вывод в лог времени выполнения каждого теста</li>
                <li>3.2: вывод сводки в конце класса: имя теста - время выполнения</li>
            </ul>
        </li>
        <li><a href="https://github.com/junit-team/junit/wiki/Rules">JUnit @Rules</a></li>
    </ul>
    <hr>
    <h3>
        <a id="user-content--типичные-ошибки-и-подсказки-по-реализации" class="anchor" aria-hidden="true" href="#-типичные-ошибки-и-подсказки-по-реализации">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672935/ef09ec1e-e6e7-11e5-9f79-d1641c05cbe6.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672935/ef09ec1e-e6e7-11e5-9f79-d1641c05cbe6.png" alt="error" style="max-width:100%;"></a> Типичные ошибки и подсказки по реализации
    </h3>
    <ul>
        <li>
            <p>1: Т.к. JPA работает с объектами, мы не можем использовать <code>userId</code> для сохранения. Можно сделать, например, так:</p>
            <pre><code> User ref = em.getReference(User.class, userId);
 meal.setUser(ref);
</code></pre>
            <p>При этом от <code>User</code> нам нужен только <code>id</code>. Над <code>id</code> создается lazy прокси, который обращается к базе при запросе любого поля. Т. е. у нас запроса в базу за юзером не будет: проверьте по логам Hibernate.</p>
        </li>
    </ul>
    <p><strong>Внимание: проверять запросы Hibernate нужно через run. Если делаете debug и брекпойнт, то могут делаться лишние запросы к базе (дебаггер дергает <code>toString</code>)</strong></p>
    <ul>
        <li>2: В JPQL запросах можно писать: <code>m.user.id=:userId</code></li>
        <li>3: При реализации <code>JpaMealRepository</code> предпочтительно не использовать <code>try-catch</code> в логике реализации. Но, если очень хочется, то ловить только специфические исключения (напр. <code>NoResultException</code>), чтобы, например, при отсутствии коннекта к базе приложение отвечало адекватно.</li>
        <li>4: Мы будем смотреть генерацию db-скриптов из модели. Для корректной генерации нужно в <code>Meal</code> добавить <code>uniqueConstraints</code></li>
        <li>5: При записи в базу через <code>namedQuery</code> валидация энтити не работает, только валидация в БД.</li>
        <li>6: Результат <code>AssertionError</code> печатает результаты через <code>toString</code>, и поля в выводе могут не совпадать с полями сравнения (<code>toString</code> одинаковый, при этом сравнение идет по другим полям и вылетает ошибка)</li>
        <li>7: Если нашему приложению <code>Meal.user</code> не требуется, не следует включать его в тесты. В следующем уроке мы потренируемся разными способами доставать зависимости <code>Meal.user</code> и <code>User.meals</code></li>
    </ul>
    <hr>
    <h2>
        <a id="user-content-выпускной-проект" class="anchor" aria-hidden="true" href="#выпускной-проект">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a href="/JavaWebinar/topjava/blob/doc/doc/graduation.md">Выпускной проект</a>
    </h2>
    <p>Новая информация плохо оседает в голове, когда дается в виде патчей. Поэтому, чтобы она стала "твоей", нужно еще раз проделать это самостоятельно. Домашнее задание на этом уроке небольшое, а полученных знаний уже достаточно для реализации выпускного проекта, основанного на нашем стеке.
        Выпускной проект делайте параллельно с нашим: прошли тему занятия - сделали ее в выпускном. Не следует забегать вперед, но и не отставайте!
    </p>
    <ul>
        <li>Для проекта я взял реальное тестовое задание, поэтому жалоб на неясность формулировок принимать не буду. Сделайте как поняли. Представьте, что это <strong>ваше тестовое задание на работу</strong></li>
        <li>Общение по выпускному в канале Slack <em>#graduation</em></li>
        <li><strong>Обязательно проверяйся <a href="/JavaWebinar/topjava/blob/doc/doc/graduation.md#-%D0%A0%D0%B5%D0%BA%D0%BE%D0%BC%D0%B5%D0%BD%D0%B4%D0%B0%D1%86%D0%B8%D0%B8">по рекомендациям в конце выпускного</a></strong></li>
        <li>По завершению вы сможете занести этот проект в свое портфолио и резюме как собственный без всяких оговорок</li>
    </ul>
    <h3>
        <a id="user-content-успехов-в-выполнении" class="anchor" aria-hidden="true" href="#успехов-в-выполнении">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Успехов в выполнении!
    </h3>
</article>
<article class="markdown-body entry-content container-lg" itemprop="text">
    <h1>
        <a id="user-content-онлайн-проект-topjava" class="anchor" aria-hidden="true" href="#онлайн-проект-topjava">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Онлайн-проект <a href="https://github.com/JavaWebinar/topjava">Topjava</a>
    </h1>
    <h2>
        <a id="user-content-материалы-занятия-скачать-все-патчи-можно-через-download-папки-patch" class="anchor" aria-hidden="true" href="#материалы-занятия-скачать-все-патчи-можно-через-download-папки-patch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a href="https://drive.google.com/drive/folders/0B9Ye2auQ_NsFfkpsWE1uX19zV19IVHd0bTlDclc5QmhMMm4xa0Npek9DT18tdkwyLTBZdXM" rel="nofollow">Материалы занятия</a> (скачать все патчи можно через Download папки patch)
    </h2>
    <h2>
        <a id="user-content--разбор-домашнего-задания-hw1" class="anchor" aria-hidden="true" href="#-разбор-домашнего-задания-hw1">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672719/09593080-e6e7-11e5-81d1-5cb629c438ca.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672719/09593080-e6e7-11e5-81d1-5cb629c438ca.png" alt="hw" style="max-width:100%;"></a> Разбор домашнего задания HW1:
    </h2>
    <ul>
        <li><strong>Перед сборкой проекта (или запуском Tomcat) откройте вкладку Maven Projects и сделайте <code>clean</code></strong></li>
        <li><strong>Если страничка в браузере работает неверно, очистите кэш (<code>Ctrl+F5</code> в хроме)</strong></li>
    </ul>
    <h3>
        <a id="user-content--1-отображения-списка-еды-в-jsp" class="anchor" aria-hidden="true" href="#-1-отображения-списка-еды-в-jsp">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 1. <a href="https://drive.google.com/open?id=0B9Ye2auQ_NsFXzByNVF3VV9zM1k" rel="nofollow">Отображения списка еды в JSP</a>
    </h3>
    <h4>
        <a id="user-content-apply-2_1_hw1patch" class="anchor" aria-hidden="true" href="#apply-2_1_hw1patch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Apply 2_1_HW1.patch
    </h4>
    <blockquote>
        <ul>
            <li>Переименовал <code>TimeUtil</code> в <code>DateTimeUtil</code></li>
            <li>Переименовал <code>mealList.jsp</code> в <code>meals.jsp</code></li>
            <li>
                Изменения в <code>MealsUtil</code>:
                <ul>
                    <li>Сделал константу <code>List&lt;Meal&gt; meals</code>. <a href="https://google.github.io/styleguide/javaguide.html#s5.2.4-constant-names" rel="nofollow">Правило именования констант, которые не "deeply immutable"</a></li>
                    <li>Для фильтрации по времени и без нее в метод <code>filterByPredicate</code> передаю реализацию <code>Predicate</code>, см. паттерн <a href="https://refactoring.guru/ru/design-patterns/strategy" rel="nofollow">Стратегия</a> и, если непонятно, <a href="https://user-images.githubusercontent.com/13649199/95467365-093a1080-0986-11eb-8177-0985456d857a.png" rel="nofollow">картинку</a></li>
                </ul>
            </li>
            <li>
                Форматирование даты сделал на основе <a href="http://stackoverflow.com/questions/35606551/jstl-localdatetime-format#35607225" rel="nofollow"> Custom EL function</a>
                <ul>
                    <li><a href="http://findnerd.com/list/view/How-to-create-a-custom-Function-for-JSTL/2869/" rel="nofollow">Create a custom Function for JSTL через tag library descriptor (TLD)</a></li>
                </ul>
            </li>
            <li>Добавил еще один способ вывести <code>dateTime</code> через стандартную JSTL функцию <code>replace</code>  (префикс <code>fn</code> в шапке также надо поменять)</li>
        </ul>
    </blockquote>
    <ul>
        <li><a href="http://java-online.ru/jsp-actions.xhtml#useBean" rel="nofollow">jsp:useBean</a></li>
        <li><a href="http://design-pattern.ru/patterns/mvc.html" rel="nofollow">MVC - Model View Controller</a></li>
    </ul>
    <h3>
        <a id="user-content--2-optional-реализация-crud" class="anchor" aria-hidden="true" href="#-2-optional-реализация-crud">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 2. <a href="https://drive.google.com/open?id=0B9Ye2auQ_NsFQndBeWFOa3phRTg" rel="nofollow">Optional: реализация CRUD</a>
    </h3>
    <h4>
        <a id="user-content-apply-2_2_hw1_optionalpatch" class="anchor" aria-hidden="true" href="#apply-2_2_hw1_optionalpatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Apply 2_2_HW1_optional.patch
    </h4>
    <p>Про использование паттерна Repository будет подробно рассказано в видео "Слои приложения"</p>
    <blockquote>
        <ul>
            <li>Согласно ответам на <a href="https://stackoverflow.com/questions/2814805/java-interfaces-implementation-naming-convention" rel="nofollow">Java Interfaces/Implementation naming convention</a>
                убрал <code>Impl</code> в <code>InMemory</code> (и всех последующих) реализациях репозиториев. Они не нужны.
            </li>
            <li>Поправил <code>InMemoryMealRepository.save()</code>. Если обновляется еда, которой нет в хранилище (c несуществующим id), вставка не происходит.</li>
            <li>В <code>MealServlet.doGet()</code> сделал выбор через <code>switch</code></li>
            <li>В местах, где требуется <code>int</code>, заменил <code>Integer.valueOf()</code> на <code>Integer.parseInt()</code></li>
            <li>В <code>mealForm.jsp</code> использую <a href="http://stackoverflow.com/questions/1890438/how-to-get-parameters-from-the-url-with-jsp#1890462" rel="nofollow">параметр запроса <code>param.action</code></a>, который не кладется в атрибуты.</li>
            <li>Переименовал <code>mealEdit.jsp</code> в <code>mealForm.jsp</code>. Поля ввода формы добавил <code>required</code></li>
            <li>Пофиксил багу c <code>history.back()</code> в <code>mealForm.jsp</code> для <strong>FireFox</strong> (коммит формы при Cancel, сделал <code>type="button"</code>).</li>
        </ul>
    </blockquote>
    <p>Дополнительно:</p>
    <ul>
        <li><a href="http://stackoverflow.com/questions/246859/http-1-0-vs-1-1" rel="nofollow">HTTP 1.0 vs 1.1</a></li>
    </ul>
    <h3>
        <a id="user-content--вопросы-по-hw1" class="anchor" aria-hidden="true" href="#-вопросы-по-hw1">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672858/9cd58692-e6e7-11e5-905d-c295d2a456f1.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672858/9cd58692-e6e7-11e5-905d-c295d2a456f1.png" alt="question" style="max-width:100%;"></a> Вопросы по HW1
    </h3>
    <blockquote>
        <p>Зачем в <code>InMemoryMealRepository</code> наполнять map с помощью нестатического блока инициализации, а не в конструкторе?</p>
    </blockquote>
    <p>В общем случае так делать не надо. Сделал, чтобы напомнить вам про эту конструкцию, см. <a href="https://habrahabr.ru/post/133237/" rel="nofollow">Малоизвестные особенности Java</a></p>
    <blockquote>
        <p>Почему <code>InMemoryMealRepository</code> не singleton?</p>
    </blockquote>
    <p>Начиная с Servlet API 2.3 пул сервлетов не создается, <a href="https://stackoverflow.com/questions/6298309" rel="nofollow">создается только один инстанс сервлетов</a>. Те. <code>InMemoryMealRepository</code> в нашем случае создается тоже только один раз. Далее все наши классы слоев приложения будут создаваться через Spring, бины которого по умолчанию являются синглтонами (в его контексте).</p>
    <blockquote>
        <p><code>Objects.requireNonNull</code> в <code>MealServlet.getId(request)</code> если у нас нет <code>id</code> в запросе бросает NPE (<code>NullPointerException</code>). Но оно вылетит и без этого метода. Зачем он нужен и почему мы его не обрабатываем?</p>
    </blockquote>
    <p><code>Objects.requireNonNull</code> - это проверка предусловия (будет подробно на 4-м занятии). Означает что в метод пришел неверный аргумент (должен быть не null) и приложение сообщает об ошибке сразу на входе (а не "может быть где-то потом"). См. <a href="https://stackoverflow.com/a/27511204/548473" rel="nofollow">What is the purpose of Objects#requireNonNull</a>. Если ее проглатывать или замазывать, то приложение возможно где-то работает неверно (приходят неверные аргументы), а мы об этом не узнаем. Красиво обрабатывать ошибки будем на последних занятиях (Spring Exception Handling).</p>
    <h2>
        <a id="user-content-занятие-2" class="anchor" aria-hidden="true" href="#занятие-2">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Занятие 2:
    </h2>
    <h3>
        <a id="user-content--3-библиотека-vs-фреймворк-стандартные-библиотеки-apache-commons-guava" class="anchor" aria-hidden="true" href="#-3-библиотека-vs-фреймворк-стандартные-библиотеки-apache-commons-guava">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 3. <a href="https://drive.google.com/open?id=0B9Ye2auQ_NsFVDJZVTktQzRYTWc" rel="nofollow">Библиотека vs Фреймворк. Стандартные библиотеки Apache Commons, Guava</a>
    </h3>
    <ul>
        <li>
            <a href="http://commons.apache.org/" rel="nofollow">Apache Commons</a>, <a href="https://github.com/google/guava/wiki">Guava</a>
            <ul>
                <li>Guava используется на проекте <a href="http://javaops.ru/reg/masterjava" rel="nofollow">Многомодульный maven. Многопоточность. XML (JAXB/StAX). Веб сервисы (JAX-RS/SOAP). Удаленное взаимодействие (JMS/AKKA)</a></li>
            </ul>
        </li>
    </ul>
    <h3>
        <a id="user-content--4-многоуровневаямногослойная-архитектура" class="anchor" aria-hidden="true" href="#-4-многоуровневаямногослойная-архитектура">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 4. <a href="https://drive.google.com/open?id=1Ve2vLlZAHwOKBfpuOL9X_jbSpQMGsLVP" rel="nofollow">Многоуровневая(многослойная) архитектура</a>
    </h3>
    <p><a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/9e253aea91180b034dbcffb858a154ecd1f6aceb5da33f9c393d2b78dd04b486/687474703a2f2f6a6176616f70732e72752f7374617469632f696d616765732f746f706a6176612f746f702d736368656d652e6a7067"><img src="https://camo.githubusercontent.com/9e253aea91180b034dbcffb858a154ecd1f6aceb5da33f9c393d2b78dd04b486/687474703a2f2f6a6176616f70732e72752f7374617469632f696d616765732f746f706a6176612f746f702d736368656d652e6a7067" alt="Слои приложения" data-canonical-src="http://javaops.ru/static/images/topjava/top-scheme.jpg" style="max-width:100%;"></a></p>
    <ul>
        <li><a href="https://metanit.com/sharp/mvc5/23.5.php" rel="nofollow">Многоуровневая(многослойная) архитектура</a></li>
        <li><a href="https://ru.wikipedia.org/wiki/Data_Access_Object" rel="nofollow">Data Access Object</a></li>
        <li><a href="http://martinfowler.com/eaaCatalog/dataTransferObject.html" rel="nofollow">Паттерн DTO</a></li>
        <li><a href="http://stackoverflow.com/questions/21554977/should-services-always-return-dtos-or-can-they-also-return-domain-models" rel="nofollow">Should services always return DTOs, or can they also return domain models?</a></li>
        <li><a href="http://stackoverflow.com/questions/31644131/spring-dto-dao-resource-entity-mapping-goes-in-which-application-layer-cont/35798539#35798539" rel="nofollow">Mapping Entity-&gt;DTO goes in which application layer: Controller or Service?</a></li>
        <li>
            Дополнительно:
            <ul>
                <li><a href="http://stackoverflow.com/questions/1612334/difference-between-dto-vo-pojo-javabeans" rel="nofollow">Value Object и Data Transfer Object</a></li>
                <li><a href="http://stackoverflow.com/questions/6640784/difference-between-active-record-and-dao" rel="nofollow">Difference between Active Record and DAO</a></li>
            </ul>
        </li>
    </ul>
    <h3>
        <a id="user-content--5-создание-каркаса-приложения-для-пользователей" class="anchor" aria-hidden="true" href="#-5-создание-каркаса-приложения-для-пользователей">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 5. <a href="https://drive.google.com/open?id=1pWsm_fNfxqPB8yygWJsMUpvWMVyRxIqt" rel="nofollow">Создание каркаса приложения для пользователей</a>
    </h3>
    <h4>
        <a id="user-content-apply-2_3_app_layerspatch" class="anchor" aria-hidden="true" href="#apply-2_3_app_layerspatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Apply 2_3_app_layers.patch
    </h4>
    <blockquote>
        <ul>
            <li>Убрал интерфейсы к сервисам. Я всегда предпочитаю писать меньше кода и в случае с одной реализацией можно обходится без них.
                По поводу инкапсуляции и отделения API от реализации - интерфейсы к сервисам это внутренняя часть приложения с одной реализацией. Меньше кода, проще поддерживать.
            </li>
            <li>Переименовал <code>ExceptionUtil</code> в <code>ValidationUtil</code></li>
            <li>Поменял <code>LoggedUser</code> на <code>SecurityUtil</code>. Это класс, из которого приложение будет получать данные залогиненного пользователя (пока <a href="https://ru.wikipedia.org/wiki/%D0%90%D1%83%D1%82%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D1%8F" rel="nofollow">аутентификации</a> нет, он реализован как заглушка). Находится в пакете <code>web</code>, т.к. аутентификация/<a href="https://ru.wikipedia.org/wiki/%D0%90%D0%B2%D1%82%D0%BE%D1%80%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F" rel="nofollow">авторизация</a> происходит на слое контроллеров и остальные слои приложения про нее знать не должны.</li>
            <li>Добавил проверку id пользователя, пришедшего в контроллер (<a href="https://stackoverflow.com/a/32728226/548473" rel="nofollow">treat IDs in REST body</a>, "If it is a public API you should be conservative when you reply, but accept liberally"). Считаю это важной частью проверки входных данных в контроллере, не забывайте это делать в ваших выпускных проектах.</li>
        </ul>
    </blockquote>
    <h2>
        <a id="user-content--ваши-вопросы" class="anchor" aria-hidden="true" href="#-ваши-вопросы">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672858/9cd58692-e6e7-11e5-905d-c295d2a456f1.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672858/9cd58692-e6e7-11e5-905d-c295d2a456f1.png" alt="question" style="max-width:100%;"></a> Ваши вопросы
    </h2>
    <blockquote>
        <p>Почему у <code>User.registered</code> тип <code>Date</code>, а <code>Meal.dateTime</code> <code>LocalDateTime </code>?</p>
    </blockquote>
    <p>По логике приложения время регистрации - абсолютное (конкретный момент), а время еды по бизнес логике относительно (те не зависит от часового пояса, завтрак и в Африке должен быть завтраком)</p>
    <blockquote>
        <p>Какова цель деления приложения на слои?</p>
    </blockquote>
    <p>Управляемость проекта (особенно большого) повышается на порядок:</p>
    <ul>
        <li>Обеспечивается меньшая связываемость. Допустим если мы меняем что-то в контроллере, то сервис эти изменения не задевают.</li>
        <li>Облегчается тестирование (мы будем тестировать слои сервисов и контроллеров отдельно)</li>
        <li>Четко разделяется функционал - где писать, куда смотреть. Не создаются <a href="https://ru.wikipedia.org/wiki/%D0%91%D0%BE%D0%B6%D0%B5%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9_%D0%BE%D0%B1%D1%8A%D0%B5%D0%BA%D1%82" rel="nofollow">God objects</a></li>
    </ul>
    <blockquote>
        <p>DTO используются когда есть избыточность запросов, которую мы уменьшаем, собрав данные из разных бинов в один? Когда DTO необходимо использовать?</p>
    </blockquote>
    <p>(D)TO может быть как частью одного entity  (набор полей) так и набором нескольких entities.
        В нашем проекте для данных, которые надо отдавать наружу и отличающихся от Entiy (хранимый бин), мы будем делать (Data) Transfer Object и класть в отдельный пакет to. Например <code>MealsTo</code> мы отдаем наружу и он является Transfer Object, его пернесем в пакет <code>to</code>.
        На многих проектах (и собеседованиях) практикуют разделение на уровне maven модулей entity слоя от логики и соответствующей конвертацией ВСЕХ Entity в TO, даже если у них те же самые поля.
        Хороший ответ когда TO обязательны есть на <a href="http://stackoverflow.com/questions/21554977/should-services-always-return-dtos-or-can-they-also-return-domain-models#21569720" rel="nofollow">stackoverflow: When to Use</a>.
    </p>
    <blockquote>
        <p>Почему контроллеры положили в папку web, а не в controllers?</p>
    </blockquote>
    <p>То же самое что <code>domain/model</code> - просто разные названия, которые устоялись в Java. Не придумывайте своих!</p>
    <blockquote>
        <p>Зачем мы наследуем <code>NotFoundException</code> от <code>RuntimeException</code>?</p>
    </blockquote>
    <p>Так с ним удобнее работать. И у нас нет никаких действий по восстановлению состояния приложения (no recoverable conditions): <a href="http://stackoverflow.com/questions/6115896/java-checked-vs-unchecked-exception-explanation" rel="nofollow">checked vs unchecked exception</a>. По последним данным checked exception вообще depricated: <a href="http://blog.takipi.com/ignore-checked-exceptions-all-the-cool-devs-are-doing-it-based-on-600000-java-projects" rel="nofollow">Ignore Checked Exceptions</a></p>
    <blockquote>
        <p>Что такое <code>ProfileRestController</code>?</p>
    </blockquote>
    <p>Контроллер, где залогиненный пользователь будет работать со своими данными</p>
    <blockquote>
        <p>Зачем в <code>AdminRestController</code> переопределяются методы родителя с вызовом тех же родительских?</p>
    </blockquote>
    <p>Сделано на будущее, мы будем менять этот код.</p>
    <blockquote>
        <p>Что лучше возвращать из API: <code>Collection</code> или <code>List</code></p>
    </blockquote>
    <p>Вообще, как правило, возвращают <code>List</code>, если не просится по коду более общий случай (например возможный <code>Set</code> или <code>Collection</code>, возвращаемый <code>Map.values()</code>). Если возвращается отсортированный список, то <code>List</code> будет адекватнее.</p>
    <h3>
        <a id="user-content--6-что-такое-spring-framework" class="anchor" aria-hidden="true" href="#-6-что-такое-spring-framework">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 6. <a href="https://www.youtube.com/watch?v=megjriLG35I" rel="nofollow">Что такое Spring Framework</a>.
    </h3>
    <ul>
        <li><a href="https://ru.wikipedia.org/wiki/Spring_Framework" rel="nofollow">Wiki: Spring Framework</a></li>
        <li><a href="https://snyk.io/blog/spring-dominates-the-java-ecosystem-with-60-using-it-for-their-main-applications/" rel="nofollow">JVM Ecosystem Report 2020: Spring</a></li>
        <li><a href="https://www.jrebel.com/blog/2020-java-technology-report" rel="nofollow">2020 Java Technology Report</a></li>
        <li><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/index.html" rel="nofollow">Spring Framework Documentation</a></li>
        <li><a href="https://habr.com/ru/post/490586/" rel="nofollow">Что такое Spring Framework? Внедрение зависимостей</a></li>
        <li><a href="https://www.youtube.com/watch?v=rd6wxPzXQvo" rel="nofollow">Евгений Борисов — Spring-построитель</a></li>
        <li>[Инверсия управления] (<a href="https://ru.wikipedia.org/wiki/%D0%98%D0%BD%D0%B2%D0%B5%D1%80%D1%81%D0%B8%D1%8F_%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F" rel="nofollow">https://ru.wikipedia.org/wiki/Инверсия_управления</a>)</li>
    </ul>
    <h4>
        <a id="user-content-apply-2_4_add_springpatch" class="anchor" aria-hidden="true" href="#apply-2_4_add_springpatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Apply 2_4_add_spring.patch
    </h4>
    <h3>
        <a id="user-content--7-запуск-spring-application-context" class="anchor" aria-hidden="true" href="#-7-запуск-spring-application-context">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 7. <a href="https://drive.google.com/file/d/1y-3ok-6CzhjnR4Rmv3-z4EV4VsElIDn6" rel="nofollow">Запуск Spring Application Context</a>
    </h3>
    <ul>
        <li><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-basics" rel="nofollow">Container Overview</a></li>
    </ul>
    <h4>
        <a id="user-content-apply-2_5_add_spring_contextpatch" class="anchor" aria-hidden="true" href="#apply-2_5_add_spring_contextpatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Apply 2_5_add_spring_context.patch
    </h4>
    <h3>
        <a id="user-content--8-dependency-injection-annotation_processing" class="anchor" aria-hidden="true" href="#-8-dependency-injection-annotation_processing">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 8. <a href="https://drive.google.com/file/d/1Z9cgULTrXxgeaqqnsh7rJtIaD2LSdzHT" rel="nofollow">Dependency Injection, Annotation_processing</a>
    </h3>
    <h4>
        <a id="user-content-apply-2_6_dependency_injectionpatch" class="anchor" aria-hidden="true" href="#apply-2_6_dependency_injectionpatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Apply 2_6_dependency_injection.patch
    </h4>
    <ul>
        <li><a href="http://habrahabr.ru/post/131993/" rel="nofollow">IoC, DI, IoC-контейнер. Просто о простом</a></li>
        <li><a href="https://habr.com/ru/post/490586/" rel="nofollow">Что такое Spring Framework? Внедрение зависимостей</a></li>
        <li><a href="https://habrahabr.ru/post/334636/" rel="nofollow">Перевод "Field Dependency Injection Considered Harmful"</a></li>
        <li><a href="http://stackoverflow.com/questions/39890849/what-exactly-is-field-injection-and-how-to-avoid-it" rel="nofollow">Field vs Constructor vs Setter DI</a></li>
    </ul>
    <h4>
        <a id="user-content-apply-2_7_annotation_processingpatch" class="anchor" aria-hidden="true" href="#apply-2_7_annotation_processingpatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Apply 2_7_annotation_processing.patch
    </h4>
    <ul>
        <li><a href="http://www.mkyong.com/spring/spring-auto-scanning-components" rel="nofollow">Spring Auto Scanning Components</a></li>
        <li><a href="http://stackoverflow.com/questions/6827752/whats-the-difference-between-component-repository-service-annotations-in" rel="nofollow">Difference between @Component, @Repository &amp; @Service annotations in Spring</a></li>
        <li><a href="http://www.seostella.com/ru/article/2012/02/12/ispolzovanie-annotacii-autowired-v-spring-3.html" rel="nofollow">Использование аннотации @Autowired</a></li>
        <li>
            Дополнительное:
            <ul>
                <li><a href="https://habr.com/ru/post/470305/" rel="nofollow">Подготовка к Spring Professional Certification. Контейнер, IoC, бины</a></li>
                <li><a href="https://github.com/spring-projects">Spring на GitHub</a></li>
                <li><a href="https://dzone.com/refcardz/spring-annotations" rel="nofollow">Spring Annotations</a></li>
            </ul>
        </li>
    </ul>
    <h4>
        <a id="user-content-дополнительно-видео-по-spring" class="anchor" aria-hidden="true" href="#дополнительно-видео-по-spring">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Дополнительно видео по Spring
    </h4>
    <ul>
        <li><a href="https://www.youtube.com/playlist?list=PL6jg6AGdCNaWF-sUH2QDudBRXo54zuN1t" rel="nofollow">Юрий Ткач: Spring Framework - The Basics</a></li>
        <li><a href="https://www.youtube.com/playlist?list=PLC97BDEFDCDD169D7" rel="nofollow">Java Brains: Spring Framework</a></li>
        <li><a href="https://www.youtube.com/watch?v=CfHDr-19WWY&amp;list=PL8X2nqRlWfaYYP1-qXjdPKE7bXYkl6aL4" rel="nofollow">Тимур Батыршинов: Spring Core - основы фреймворка, ядро</a></li>
    </ul>
    <h2>
        <a id="user-content--ваши-вопросы-1" class="anchor" aria-hidden="true" href="#-ваши-вопросы-1">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672858/9cd58692-e6e7-11e5-905d-c295d2a456f1.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672858/9cd58692-e6e7-11e5-905d-c295d2a456f1.png" alt="question" style="max-width:100%;"></a> Ваши вопросы
    </h2>
    <blockquote>
        <p>Что такое схема в spring-app.xml xsi:schemaLocation и зачем она нужна</p>
    </blockquote>
    <p><a href="https://ru.wikipedia.org/wiki/XML_Schema" rel="nofollow">XML схема</a> нужна для валидации xml, IDEA делает по ней автозаполнение.</p>
    <blockquote>
        <p>Что означает для Spring</p>
    </blockquote>
    <pre><code> &lt;bean class="ru.javawebinar.topjava.service.UserService"&gt;
     &lt;property name="repository" ref="inmemoryUserRepository"/&gt;
 &lt;/bean&gt; ?
</code></pre>
    <p>Можно сказать так: создай и занеси в свой контекст экземпляр класса (бин) <code>UserService</code> и присвой его проперти <code>repository</code> бин <code>inmemoryUserRepository</code>, который возьми из своего контекста.</p>
    <blockquote>
        <p><code>SecurityUtil.authUserId()</code>  и <code>user.id</code> это одно и то или это разные вещи?</p>
    </blockquote>
    <p><code>User.id</code> это уникальный идентификатор юзера, которых в приложении много.
        <code>SecurityUtil.authUserId()</code> это идентификатор <code>id</code> залогиненного юзера. Мы можем, например, получить самого залогиненного юзера, выполнив запрос с <code>User.id==SecurityUtil.authUserId()</code>
        Когда вы логинитесь в свое почтовое приложение, оно отдает вам именно ваши письма на основе вашего <code>id</code>, который она определяет и запоминает во время аутентификации (логина).<br>
        У нас пока этого нет и <code>id</code> задается константой (хардкодится). Но когда мы сделаем настоящую аутентификацию, все будет работать для любого залогиненного пользователя.
    </p>
    <blockquote>
        <p>Как биндинг происходит для <code>@Autowired</code>? Как поступать, если у нас больше одной реализации <code>UserRepository</code>?</p>
    </blockquote>
    <p><code>@Autowired</code>  инжектит по типу (т.е. ижектит класс который реализует <code>UserRepository</code>). Обычно он один. Если у нас несколько реализаций, Spring не поднимится и поругается - <code>No unique bean</code>.
        В этом случае <a href="http://www.mkyong.com/spring/spring-autowiring-qualifier-example/" rel="nofollow">можно уточнить имя бина через @Qualifier</a>. <code>@Qualifier</code> обычно добавляют только в случае нескольких реализаций.
        См. <a href="https://stackoverflow.com/a/2153680/548473" rel="nofollow">Inject 2 beans of same type</a>
    </p>
    <blockquote>
        <p>Почему нельзя сервлет помещать в Spring контекст?</p>
    </blockquote>
    <p>Сервлеты- это исключительно классы <code>servlet-api</code> (веб контейнера), они инстанциируются Tomcat. Те технически можно (без <code>init/destroy</code>), но идеологически - неверно. Cоздастся два сервлета: один настоящий, Tomcat-ом, и второй - нерабочий, Spring-ом. НЕ надо включать сервлет в контекст Spring.</p>
    <hr>
    <ul>
        <li><strong>Еще раз смотрим на <a href="http://topjava.herokuapp.com" rel="nofollow">демо приложение</a> и вникаем, что такое пользователь и его еда и что он может с ней сделать.
            Когда пользователь логинится в приложении, его id и норма калорий "чудесным образом" попадают в  <code>SecurityUtil.authUserId() / SecurityUtil.authUserCaloriesPerDay()</code>. Как они реально туда попадут будет в уроке  9 (Spring Security, сессия и куки)</strong>
        </li>
        <li><strong>Перед началом выполнения ДЗ (если есть хоть какие-то сомнения) прочитайте ВСЕ ДЗ. Если вопросы остаются - то ВСЕ подсказки</strong>. Особенно этот пункт важный, когда будете делать реальное рабочее ТЗ.</li>
    </ul>
    <h2>
        <a id="user-content--домашнее-задание-hw02" class="anchor" aria-hidden="true" href="#-домашнее-задание-hw02">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672719/09593080-e6e7-11e5-81d1-5cb629c438ca.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672719/09593080-e6e7-11e5-81d1-5cb629c438ca.png" alt="hw" style="max-width:100%;"></a> Домашнее задание HW02
    </h2>
    <ul>
        <li>1: Имплементировать <code>InMemoryUserRepository</code> по аналогии с <code>InMemoryMealRepository</code> (список пользователей возвращать отсортированным по имени)</li>
        <li>2: сделать <code>Meal extends AbstractBaseEntity</code>, <code>MealTo</code> перенести в пакет <code>ru.javawebinar.topjava.to</code> (transfer objects)</li>
        <li>
            3: Изменить <code>MealRepository</code> и <code>InMemoryMealRepository</code> таким образом, чтобы вся еда всех пользователей находилась в одном общем хранилище, но при этом каждый конкретный аутентифицированный пользователь мог видеть и редактировать только свою еду.
            <ul>
                <li>3.1: реализовать хранение еды для каждого пользователя можно с добавлением поля <code>userId</code> в <code>Meal</code> ИЛИ без него (как нравится). Напомню, что репозиторий один и приложение может работать одновременно с многими пользователями.</li>
                <li>3.2: если по запрошенному id еда отсутствует или чужая, возвращать <code>null/false</code> (см. комментарии в <code>MealRepository</code>)</li>
                <li>3.3: список еды возвращать отсортированный в обратном порядке по датам</li>
                <li>3.4: дополнительно: попробуйте сделать реализацию атомарной  (те учесть коллизии при одновременном изменении еды одного пользователя)</li>
            </ul>
        </li>
        <li>
            4: Реализовать слои приложения для функциональности "еда". API контроллера должна удовлетворять все потребности демо приложения и ничего лишнего (см. <a href="http://topjava.herokuapp.com" rel="nofollow">демо</a>). Поиск и изменение порядка сортировки в таблице демо приложения реализованы на UI (в браузере), в приложении делать не нужно.
            <ul>
                <li><strong>Смотрите на реализацию слоя для user и делаете по аналогии! Если там что-то непонятно, не надо исправлять или делать по своему. Задавайте вопросы. Если действительно нужна правка - я сделаю и напишу всем.</strong></li>
                <li>4.1: после авторизации (сделаем позднее), id авторизованного юзера можно получить из <code>SecurityUtil.authUserId()</code>. Запрос попадает в контроллер, методы которого будут доступны снаружи по http, т.е. запрос можно будет сделать с ЛЮБЫМ id для еды
                    (не принадлежащем авторизированному пользователю). Нельзя позволять модифицировать/смотреть чужую еду.
                </li>
                <li>4.2: <code>SecurityUtil</code> может использоваться только на слое web (см. реализацию <code>ProfileRestController</code>). <code>MealService</code> можно тестировать без подмены логики авторизации, поэтому <strong>в методы сервиса и репозитория мы передаем параметр <code>userId</code>: id авторизованного пользователя (предполагаемого владельца еды)</strong>.</li>
                <li>4.3: если еда не принадлежит авторизированному пользователю или отсутствует, в <code>MealService</code> бросать <code>NotFoundException</code>.</li>
                <li>4.4: конвертацию в <code>MealTo</code> можно делать как в слое web, так и в service (<a href="http://stackoverflow.com/questions/31644131" rel="nofollow">Mapping Entity-&gt;DTO: Controller or Service?</a>)</li>
                <li>4.5: в <code>MealService</code> постараться сделать в каждом методе только одни запрос к <code>MealRepository</code></li>
                <li>4.6 еще раз: не надо в названиях методов повторять названия класса (<code>Meal</code>).</li>
            </ul>
        </li>
        <li>5: включить классы еды в контекст Spring (добавить аннотации) и вызвать из <code>SpringMain</code> любой метод <code>MealRestController</code> (проверить что Spring все корректно заинжектил)</li>
    </ul>
    <h3>
        <a id="user-content-optional" class="anchor" aria-hidden="true" href="#optional">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Optional
    </h3>
    <ul>
        <li>6: в <code>MealServlet</code> сделать инициализацию Spring, достать <code>MealRestController</code> из контекста и работать с едой через него (<strong>как в <code>SpringMain</code></strong>). <code>pom.xml</code> НЕ менять, работаем со <code>spring-context</code>. Сервлет обращается к контролеру, контроллер вызывает сервис, сервис - репозиторий. Когда будем работать через Spring MVC, <code>MealServlet</code> удалим, останется только контроллер.</li>
        <li>7: добавить в <code>meals.jsp</code> и <code>MealServlet</code> фильтрацию еды по дате и по времени (см. <a href="http://topjava.herokuapp.com" rel="nofollow">демо</a>). Сброс фильтра делать не надо (реализуем через ajax в HW8). ВНИМАНИЕ: в приложении фильтрация делается не по интервалу дата-время, а отдельно по датам и затем отдельно по времени.</li>
        <li>8: добавить выбор текущего залогиненного пользователя (имитация аутентификации, сделать Select с двумя элементами со значениями 1 и 2 в <code>index.html</code> и <code>SecurityUtil.setAuthUserId(userId)</code> в <code>UserServlet</code>). От выбора user или admin будет зависеть отображение еды: user-а или admin-а.
            Настоящая аутентификация будет через Spring Security позже.
        </li>
    </ul>
    <hr>
    <h3>
        <a id="user-content-итоги-занятия-после-выполнения-дз" class="anchor" aria-hidden="true" href="#итоги-занятия-после-выполнения-дз">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Итоги занятия после выполнения ДЗ:
    </h3>
    <p>Мы создали архитектуру нашего приложения с разделением на слои и внедрили в наш проект фреймворк Spring, который их связывает.<br>
        Далее мы реализовали функционал нашего приложения, как он сделан в <a href="http://topjava.herokuapp.com" rel="nofollow">демо приложении</a> (но с фиктивной аутентификацией)
    </p>
    <hr>
    <h3>
        <a id="user-content--типичные-ошибки-и-подсказки-по-реализации" class="anchor" aria-hidden="true" href="#-типичные-ошибки-и-подсказки-по-реализации">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672935/ef09ec1e-e6e7-11e5-9f79-d1641c05cbe6.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672935/ef09ec1e-e6e7-11e5-9f79-d1641c05cbe6.png" alt="error" style="max-width:100%;"></a> Типичные ошибки и подсказки по реализации
    </h3>
    <ul>
        <li>
            1: <strong>В реализации <code>InMemoryUserRepository</code></strong>
            <ul>
                <li>1.1: <code>getByEmail</code> попробуйте сделать через <code>stream</code></li>
                <li>1.2: <code>delete</code> попробуйте сделать за одно обращение к map (без <code>containsKey</code>). При удалении пользователя его еду можно оставить, при реализации в базе будет CASCADE.</li>
                <li>1.3: при запросе списка юзеров предусмотрите случай одинаковых <code>User.name</code> (порядок должен быть зафиксированным). Поле <code>User.email</code>у нас уникально - в базе будет ограничение.</li>
            </ul>
        </li>
        <li>
            2: <strong>В реализации <code>InMemoryMealRepository</code></strong>
            <ul>
                <li>2.1: В <code>Meal</code>, которая приходит из браузера в контроллер, нет никакой информации о пользователе (еда приходит в контроллер <strong>БЕЗ <code>user/userId</code>, она может быть только от авторизированного пользователя</strong>). По id еды и авторизованному пользователю нужно проверить ее принадлежность (его это еда или чужая)
                    <strong>Проверьте сценарий: авторизованный пользователь пробует изменить чужую еду (id еды ему не принадлежит).</strong>
                </li>
                <li>2.2: <code>get\update\delete</code> - следите, чтобы не было NPE (<code>NullPointException</code> может быть, если в хранилище отсутствует юзер или еда).</li>
                <li>2.3: Фильтрацию по датам сделать в репозитории т.к. из базы будем брать сразу отфильтрованные по дням записи. Следите чтобы <strong>первый и последний день не были обрезаны, иначе сумма калорий будет неверная</strong>.</li>
                <li>2.4: Если запрашивается список и он пустой, не возвращайте NULL! По пустому списку можно легко итерироваться без риска <code>NullPoinException</code>.</li>
                <li>2.5: Не дублируйте код в <code>getAll</code> и метод с фильтрацией</li>
                <li>2.6: попробуйте учесть, что следующая реализация (сортировка, фильтрация) будет делаться прямо в базе данных</li>
            </ul>
        </li>
        <li>3: Проверьте, что удалили <code>Meal.id</code> и связанные с ним методы (он уже есть в базовом <code>BaseEntity</code>)</li>
        <li>4: Проверку <code>isBetweenHalfOpen</code> с датами сделать в <code>DateTimeUtil</code>. Если фильтруете по <code>LocalTime</code> и <code>LocalDateTime</code>, попробуйте использовать один метод и дженерики (см. <a href="https://docs.oracle.com/javase/tutorial/extra/generics/morefun.html" rel="nofollow">Generics Tutorials</a> и
            <a href="https://habr.com/ru/company/sberbank/blog/416413/" rel="nofollow">Погружаемся в Java Generics</a>)
        </li>
        <li>
            5: <strong>Реализация 'MealRestController' должен уметь обрабатывать запросы</strong>:
            <ul>
                <li>5.1: Отдать свою еду (для отображения в таблице, формат <code>List&lt;MealTo&gt;</code>), запрос БЕЗ параметров</li>
                <li>5.2: Отдать свою еду, отфильтрованную по startDate, startTime, endDate, endTime</li>
                <li>5.3: Отдать/удалить свою еду по id, параметр запроса - id еды. Если еда с этим id чужая или отсутствует - <code>NotFoundException</code></li>
                <li>5.4: Сохранить/обновить еду, параметр запроса - Meal. Если обновляемая еда с этим id чужая или отсутствует - <code>NotFoundException</code></li>
                <li>5.5: Сервлет мы удалим, а контроллер останется, поэтому возвращать <code>List&lt;MealTo&gt;</code> надо из контроллера. И userId принимать в контроллере НЕЛЬЗЯ (иначе - для чего аторизация?).</li>
                <li>5.6: В концепции REST при update дополнительно принято передавать id (см. <code>AdminRestController.update</code>)</li>
                <li>5.7: Для получения всей своей еды сделайте отдельный <code>getAll</code> без применения фильтра</li>
            </ul>
        </li>
        <li>6: Проверьте корректную обработку пустых значений date и time (в частности, если все значения пустые, должен выводится весь список)</li>
        <li>7: <code>id</code> авторизированного пользователя получаем так: <code>SecurityUtil.authUserId()</code>, cм. <code>ProfileRestController</code></li>
        <li>
            8: В <code>MealServlet</code>
            <ul>
                <li>8.1: Закрывать springContext в сервлете грамотнее всего в <code>HttpServlet.destroy()</code>: если где-то в контексте Spring будет ленивая инициализация, метод-фабрика, не синглтон-scope, то контекст понадобится при работе приложения. У нас такого нет, но делать надо все грамотно.</li>
                <li>8.2: Не храните параметры фильтра как члены класса сервлета, это не многопоточно! Один экземпляр сервлета используется всеми запросами на сервер, попробуйте дернуть его из 2х браузеров.</li>
                <li>8.3: В сервлете нельзя использовать <code>@Autowired</code> и <code>@Component</code>. См вопрос выше- "Почему нельзя сервлет помещать в Spring контекст?"</li>
            </ul>
        </li>
    </ul>
    <h4>
        <a id="user-content-если-с-дз-большие-сложности-можно-получить-итоговые-meal-интерфейсы-для-сверки-в-личке-katherine-valeria" class="anchor" aria-hidden="true" href="#если-с-дз-большие-сложности-можно-получить-итоговые-meal-интерфейсы-для-сверки-в-личке-katherine-valeria">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Если с ДЗ большие сложности, можно получить итоговые Meal интерфейсы для сверки в личке (<code>@Katherine</code>, <code>@Valeria</code>).
    </h4>
    <p>И напоследок история от Татьяны:</p>
    <blockquote>
        <p>2.1 По id еды и авторизованному пользователю нужно проверить ее принадлежность.</p>
    </blockquote>
    <p>На примере уточню:
        Вася Пупкин нашел неименную банковскую карточку, т.е. номер есть, но имени нет.
        Т.к. Вася не очень честный человек, то решил снять деньги с чужой карточки.
        Наклеил <em>стикер со своим именем</em> на карточку и пришел в банк. Дает свой паспорт и карточку операционисту и просит снять всю наличность.
        Варианты:
    </p>
    <ol>
        <li>операционист сверяет стикер на карточке и паспорт - все ок, Вася получает наличность</li>
        <li>операционист не обращает внимания на стикер, <em>а делает запрос в БД по номеру и сверяет ФИО в БД с паспортом</em> - ФИО не совпали, Вася в пролете</li>
    </ol>
    <p>Кто и так это понимает, тому небольшой спойлер. А кто не понимает, может, переспросят, пообсуждают.</p>
</article>
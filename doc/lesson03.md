<article class="markdown-body entry-content container-lg" itemprop="text">
    <h1>
        <a id="user-content-онлайн-проект-topjava" class="anchor" aria-hidden="true" href="#онлайн-проект-topjava">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Онлайн-проект <a href="https://github.com/JavaWebinar/topjava">Topjava</a>
    </h1>
    <h2>
        <a id="user-content-материалы-занятия--скачать-все-патчи-можно-через-download-папки-patch" class="anchor" aria-hidden="true" href="#материалы-занятия--скачать-все-патчи-можно-через-download-папки-patch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a href="https://drive.google.com/drive/u/0/folders/0B9Ye2auQ_NsFT1NxdTFOQ1dvVnM" rel="nofollow">Материалы занятия</a>  (скачать все патчи можно через Download папки patch)
    </h2>
    <blockquote>
        <p><strong>ВНИМАНИЕ! При удалении класса из исходников, его скомпилированная версия все еще будет находиться в target (и classpath). В этом случае (или в любом другом, когда проект начинает глючить) сделайте <code>mvn clean</code>.</strong></p>
    </blockquote>
    <h3>
        <a id="user-content--правки-в-проекте" class="anchor" aria-hidden="true" href="#-правки-в-проекте">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672935/ef09ec1e-e6e7-11e5-9f79-d1641c05cbe6.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672935/ef09ec1e-e6e7-11e5-9f79-d1641c05cbe6.png" alt="correction" style="max-width:100%;"></a> Правки в проекте
    </h3>
    <h4>
        <a id="user-content-apply-3_0_fixpatch" class="anchor" aria-hidden="true" href="#apply-3_0_fixpatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Apply 3_0_fix.patch
    </h4>
    <ul>
        <li>Fix grammar</li>
    </ul>
    <h2>
        <a id="user-content--разбор-домашнего-задания-hw02" class="anchor" aria-hidden="true" href="#-разбор-домашнего-задания-hw02">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672719/09593080-e6e7-11e5-81d1-5cb629c438ca.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672719/09593080-e6e7-11e5-81d1-5cb629c438ca.png" alt="hw" style="max-width:100%;"></a> Разбор домашнего задания HW02
    </h2>
    <h3>
        <a id="user-content--1-реализация-репозиториев" class="anchor" aria-hidden="true" href="#-1-реализация-репозиториев">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 1. <a href="https://drive.google.com/file/d/1hZay5jV-mVEByMnDveZ36jUAY0I3WChT" rel="nofollow">Реализация репозиториев</a>
    </h3>
    <h4>
        <a id="user-content-apply-3_01_hw2_repositoriespatch" class="anchor" aria-hidden="true" href="#apply-3_01_hw2_repositoriespatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Apply 3_01_HW2_repositories.patch
    </h4>
    <h3>
        <a id="user-content--2-фильтрация-в-репозитории" class="anchor" aria-hidden="true" href="#-2-фильтрация-в-репозитории">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 2. <a href="https://drive.google.com/file/d/1s1tAsopU60gRvMaL53TP9EjS1gap99s3" rel="nofollow">Фильтрация в репозитории</a>
    </h3>
    <p>Метод <code>MealRepository.getBetweenHalfOpen</code> мы используем в следующем патче для фильтрации по целым дням.<br>
        Используем <code>LocalDateTime</code> вместо <code>LocalDate</code> с прицелом на то, что в DB тип даты - <code>timestamp</code>.
    </p>
    <h4>
        <a id="user-content-apply-3_02_hw2_repo_filterspatch" class="anchor" aria-hidden="true" href="#apply-3_02_hw2_repo_filterspatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Apply 3_02_HW2_repo_filters.patch
    </h4>
    <ul>
        <li>Бага в <code>usersMealsMap.computeIfAbsent(userId, ConcurrentHashMap::new)</code> - создается  <code>new ConcurrentHashMap(userId)</code>, что неверно. В патче <code>3_04_refactor_repository</code> этот код рефакторится, поэтому просто примите к сведению и не делайте так!
            Проверьте себя, что знаете как исправить (чекинить правку не надо, чтобы не было конфликтов)
        </li>
        <li><a href="https://www.jetbrains.com/help/idea/nullable-and-notnull-annotations.html" rel="nofollow">Spring <code>@Nullable</code> аннотации</a></li>
    </ul>
    <h3>
        <a id="user-content--3-meals-layers" class="anchor" aria-hidden="true" href="#-3-meals-layers">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 3. <a href="https://drive.google.com/file/d/1jwd4Yhdy434fUAQyjpsZOO24XT-4lfp8" rel="nofollow">Meals Layers</a>
    </h3>
    <blockquote>
        <ul>
            <li>В <code>DateTimeUtil</code> переименовал методы. Название должно описывать, "что метод делает", а не "зачем его вызывают".</li>
            <li>Переименовал <code>getBetween</code> для дат. Для времени у нас полуоткрытый диапазон, для дат - закрытый.</li>
        </ul>
    </blockquote>
    <h4>
        <a id="user-content-apply-3_03_hw2_meal_layerspatch" class="anchor" aria-hidden="true" href="#apply-3_03_hw2_meal_layerspatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Apply 3_03_HW2_meal_layers.patch
    </h4>
    <ul>
        <li><a href="http://stackoverflow.com/questions/21554977/548473" rel="nofollow">Should services always return DTOs, or can they also return domain models?</a></li>
        <li><a href="https://stackoverflow.com/a/35798539/548473" rel="nofollow">Mapping Entity-&gt;DTO goes in which application layer: Controller or Service?</a></li>
    </ul>
    <h3>
        <a id="user-content-рефакторинг-inmemory-репозиториев" class="anchor" aria-hidden="true" href="#рефакторинг-inmemory-репозиториев">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Рефакторинг InMemory репозиториев
    </h3>
    <h4>
        <a id="user-content-apply-3_04_refactor_repositorypatch" class="anchor" aria-hidden="true" href="#apply-3_04_refactor_repositorypatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Apply 3_04_refactor_repository.patch
    </h4>
    <ul>
        <li>сделал базовый <code>InMemoryBaseRepository</code></li>
        <li>наследую от него <code>InMemoryUserRepository</code></li>
        <li>использую его в <code>InMemoryMealRepository</code> вместо <code>Map&lt;Integer, Meal&gt;</code></li>
    </ul>
    <p>Обратите внимание на <code>InMemoryBaseRepository.counter</code> - счетчик один, общий для всех хранимых объектов</p>
    <h3>
        <a id="user-content--4-hw2-optional" class="anchor" aria-hidden="true" href="#-4-hw2-optional">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 4. <a href="https://drive.google.com/file/d/1yzNvGBgjgtuKXDFo983OqtTNoHDbyn1z" rel="nofollow">HW2 Optional</a>
    </h3>
    <h4>
        <a id="user-content-apply-3_05_hw2_optional_mealservletpatch" class="anchor" aria-hidden="true" href="#apply-3_05_hw2_optional_mealservletpatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Apply 3_05_HW2_optional_MealServlet.patch
    </h4>
    <blockquote>
        <ul>
            <li>Заменил <code>@Depricated StringUtils.isEmpty</code> на <code>hasLength</code> (условие приходится инвертировать). <strong>ВНИМАНИЕ: <a href="https://drive.google.com/file/d/10he49sS_2B1yRmPl3qeIcbVUQ3N58-YI" rel="nofollow">обновленный патч от 18.02 в 11.23</a></strong></li>
            <li>Убрал логирование (уже есть в контроллере)</li>
            <li><code>assureIdConsistent</code> позволяет в контроллере обновлять еду с <code>id=null</code></li>
        </ul>
    </blockquote>
    <h4>
        <a id="user-content-apply-3_06_hw2_optional_filterpatch" class="anchor" aria-hidden="true" href="#apply-3_06_hw2_optional_filterpatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Apply 3_06_HW2_optional_filter.patch
    </h4>
    <ul>
        <li><a href="https://stackoverflow.com/a/1890462/548473" rel="nofollow">JSP Implicit Objects</a></li>
        <li><a href="https://developer.mozilla.org/ru/docs/Web/Guide/HTML/Using_data_attributes" rel="nofollow">Использование data-* атрибутов</a></li>
    </ul>
    <h4>
        <a id="user-content-apply-3_07_hw2_optional_select_userpatch" class="anchor" aria-hidden="true" href="#apply-3_07_hw2_optional_select_userpatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Apply 3_07_HW2_optional_select_user.patch
    </h4>
    <h3>
        <a id="user-content--вопросы-по-hw2" class="anchor" aria-hidden="true" href="#-вопросы-по-hw2">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672858/9cd58692-e6e7-11e5-905d-c295d2a456f1.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672858/9cd58692-e6e7-11e5-905d-c295d2a456f1.png" alt="question" style="max-width:100%;"></a> Вопросы по HW2
    </h3>
    <blockquote>
        <p>Что делает <code>repository.computeIfAbsent / computeIfPresent</code> ?</p>
    </blockquote>
    <p>Всегда пробуйте ответить на вопрос сами. Достаточно просто зайти по Ctrl+мышка в реализацию и посмотреть javadoc и <strong>их дефолтную реализацию</strong></p>
    <blockquote>
        <p>Почему выбрана реализация <code>Map&lt;userId, Map&lt;mealId,Meal&gt;&gt;</code> а не <code>Meal.userId + Map&lt;mealId,Meal&gt;</code> ?</p>
    </blockquote>
    <p>В данном случае двойная мапа (мультимап) - самый эффективный способ хранения, который не требует итерирования (перебора всех значений). С другой стороны затраты по памяти в этом решении больше.</p>
    <blockquote>
        <p><strong>Вопрос вам (очень важный):</strong> можно ли в <code>MealRestController</code> контроллере сделать член класса <code>private int userId = SecurityUtil.authUserId()</code> и использовать его в методах контроллера?</p>
    </blockquote>
    <h2>
        <a id="user-content-занятие-3" class="anchor" aria-hidden="true" href="#занятие-3">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Занятие 3:
    </h2>
    <h3>
        <a id="user-content--5-коротко-о-жизненном-цикле-spring-контекста" class="anchor" aria-hidden="true" href="#-5-коротко-о-жизненном-цикле-spring-контекста">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 5. <a href="https://drive.google.com/open?id=0B9Ye2auQ_NsFOU8wWlpPVE05STA" rel="nofollow">Коротко о жизненном цикле Spring контекста.</a>
    </h3>
    <h4>
        <a id="user-content-apply-3_08_bean_life_cyclepatch" class="anchor" aria-hidden="true" href="#apply-3_08_bean_life_cyclepatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Apply 3_08_bean_life_cycle.patch
    </h4>
    <blockquote>
        <p><strong>Если у вас JDK больше 8, <a href="https://stackoverflow.com/a/46502132/548473" rel="nofollow">добавьте в pom <code>javax.annotation-api</code></a>. На JDK 15 перейдем в 5 занятии.</strong></p>
    </blockquote>
    <ul>
        <li><a href="http://habrahabr.ru/post/222579/" rel="nofollow">Spring изнутри. Этапы инициализации контекста.</a></li>
        <li>
            Ресурсы:
            <ul>
                <li><a href="https://www.youtube.com/watch?v=BmBr5diz8WA" rel="nofollow">Евгений Борисов. Spring, часть 1</a></li>
                <li><a href="https://www.youtube.com/watch?v=cou_qomYLNU" rel="nofollow">Евгений Борисов. Spring, часть 2</a></li>
            </ul>
        </li>
    </ul>
    <h3>
        <a id="user-content---6-тестирование-через-junit" class="anchor" aria-hidden="true" href="#--6-тестирование-через-junit">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a>  6. <a href="https://www.youtube.com/watch?v=wSVg6_iK2Aw" rel="nofollow">Тестирование через JUnit</a>
    </h3>
    <h3>
        <a id="user-content-внимание-перед-накаткой-патча-создайте-каталог-test-из-корня-проекта-путь-srctest-иначе-часть-файлов-попадет-в-srcmain" class="anchor" aria-hidden="true" href="#внимание-перед-накаткой-патча-создайте-каталог-test-из-корня-проекта-путь-srctest-иначе-часть-файлов-попадет-в-srcmain">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        ВНИМАНИЕ!! Перед накаткой патча создайте каталог test (из корня проекта путь <code>\src\test</code>), иначе часть файлов попадет в <code>src\main</code>.
    </h3>
    <blockquote>
        <ul>
            <li>"Deeply mutable" константы <code>UserTestData.user/admin</code> <a href="https://google.github.io/styleguide/javaguide.html#s5.2.4-constant-names" rel="nofollow">сделал lowercase</a>.</li>
        </ul>
    </blockquote>
    <ul>
        <li>все классы, которые не нужны при работе приложения переносятся в test (и не включаются в сборку)</li>
        <li>в тестах очень частая ошибка - менять местами <code>expected</code> (ожидаемое) и <code>actual</code> (фактическое) значения.</li>
        <li><a href="https://ru.wikipedia.org/wiki/%D0%A0%D0%B5%D0%B3%D1%80%D0%B5%D1%81%D1%81%D0%B8%D0%BE%D0%BD%D0%BD%D0%BE%D0%B5_%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5" rel="nofollow">Регрессионное тестирование</a></li>
        <li><a href="https://ru.wikipedia.org/wiki/%D0%A0%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B0_%D1%87%D0%B5%D1%80%D0%B5%D0%B7_%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5" rel="nofollow">Разработка через тестирование</a></li>
        <li><a href="http://www.javenue.info/post/19" rel="nofollow">Тестирование Java кода с помощью JUnit</a></li>
        <li><a href="https://maven.apache.org/surefire/maven-surefire-plugin/usage.html" rel="nofollow">maven-surefire-plugin</a></li>
        <li>
            Дополнительно:
            <ul>
                <li><a href="http://junit.org/junit4" rel="nofollow">JUnit 4</a></li>
                <li><a href="http://habrahabr.ru/post/120101/" rel="nofollow">Тестирование в Java. JUnit</a></li>
                <li><a href="https://habr.com/ru/post/169381/" rel="nofollow">Юнит-тестирование для чайников</a></li>
                <li><a href="https://www.youtube.com/watch?v=z9jEVLCF5_w" rel="nofollow">Тестирование кода Java с помощью фреймворка JUnit</a> (youtube)</li>
            </ul>
        </li>
    </ul>
    <h4>
        <a id="user-content-apply-3_09_add_junitpatch" class="anchor" aria-hidden="true" href="#apply-3_09_add_junitpatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Apply 3_09_add_junit.patch
    </h4>
    <h3>
        <a id="user-content-после-патча-сделайте-clean-и-обновите-зависимости-maven-чтобы-idea-определила-сорсы-тестов" class="anchor" aria-hidden="true" href="#после-патча-сделайте-clean-и-обновите-зависимости-maven-чтобы-idea-определила-сорсы-тестов">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        После патча сделайте <code>clean</code> и <a href="https://github.com/JavaOPs/topjava/wiki/IDEA#maven_update">обновите зависимости Maven</a>, чтобы IDEA определила сорсы тестов
    </h3>
    <h4>
        <a id="user-content--вопрос-почему-проект-упадет-при-попытке-открыть-страничку-еды-в-логе-смотреть-самый-верх-самого-нижнего-исключения" class="anchor" aria-hidden="true" href="#-вопрос-почему-проект-упадет-при-попытке-открыть-страничку-еды-в-логе-смотреть-самый-верх-самого-нижнего-исключения">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672858/9cd58692-e6e7-11e5-905d-c295d2a456f1.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672858/9cd58692-e6e7-11e5-905d-c295d2a456f1.png" alt="question" style="max-width:100%;"></a> Вопрос: почему проект упадет при попытке открыть страничку еды (в логе смотреть самый верх самого нижнего исключения)?
    </h4>
    <ul>
        <li>В <code>InMemoryUserRepository</code> при инициализации репозиториев никак не учитывается/сбрасывается счетчик. Тк у нас все тесты будут с базой данных, это прошло незамеченным много потоков.
            Предлагайте свои решения <a href="https://topjava22.slack.com/archives/C01ND5ZEH61/p1613650411020800?thread_ts=1613650344.020700&amp;cid=C01ND5ZEH61" rel="nofollow">в обсуждении</a>
        </li>
    </ul>
    <h3>
        <a id="user-content--7-spring-test" class="anchor" aria-hidden="true" href="#-7-spring-test">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 7. <a href="https://drive.google.com/open?id=0B9Ye2auQ_NsFai1veG9qaFZlZ2s" rel="nofollow">Spring Test</a>
    </h3>
    <blockquote>
        <ul>
            <li>поменял <code>@RunWith</code>: <code>SpringRunner</code> is an alias for the <code>SpringJUnit4ClassRunner</code></li>
        </ul>
    </blockquote>
    <h4>
        <a id="user-content-apply-3_10_add_spring_testpatch" class="anchor" aria-hidden="true" href="#apply-3_10_add_spring_testpatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Apply 3_10_add_spring_test.patch
    </h4>
    <ul>
        <li><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/testing.html" rel="nofollow">Spring Testing</a></li>
    </ul>
    <h3>
        <a id="user-content--8-базы-данных-обзор-nosql-и-java-persistence-solution-без-orm" class="anchor" aria-hidden="true" href="#-8-базы-данных-обзор-nosql-и-java-persistence-solution-без-orm">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 8. <a href="https://drive.google.com/open?id=0B9Ye2auQ_NsFVlNYczhnSU9JdXc" rel="nofollow">Базы данных. Обзор NoSQL и Java persistence solution без ORM.</a>
    </h3>
    <blockquote>
        <p><strong>Рекомендуется PostgreSQL 13</strong></p>
    </blockquote>
    <ul>
        <li><a href="https://ru.wikipedia.org/wiki/PostgreSQL" rel="nofollow">PostgreSQL</a>.</li>
        <li><a href="https://github.com/pgjdbc/pgjdbc">PostgreSQL JDBC Driver</a></li>
        <li><a href="http://java-course.ru/begin/postgresql/" rel="nofollow">Установка PostgreSQL</a>.</li>
        <li>
            Чтобы избежать проблем с правами и именами каталогов, <a href="https://stackoverflow.com/questions/43432713/548473" rel="nofollow"><strong>рекомендуют установить postgres в простой каталог, например <code>C:\Postgresql</code></strong>. И при проблемах создать каталог data на другом диске</a>. Если Unix, <a href="http://www.sql.ru/forum/765555/permissions-should-be-u-rwx-0700" rel="nofollow">проверить права доступа к папке (0700)</a>. Название ПК и имя пользователя должны быть латиницей (или можно устанавливать сервер <a href="https://postgrespro.ru/windows" rel="nofollow">отсюда</a>)
            <ul>
                <li><a href="https://losst.ru/ustanovka-postgresql-ubuntu-16-04" rel="nofollow">Установка PostgreSQL в UBUNTU</a></li>
                <li><a href="https://computingforgeeks.com/install-postgresql-13-on-fedora/" rel="nofollow">Install PostgreSQL 13 on Fedora</a></li>
            </ul>
        </li>
    </ul>
    <blockquote>
        <p>Создать в pgAdmin новую базу <code>topjava</code> и новую роль <code>user</code>, пароль <code>password</code></p>
    </blockquote>
    <p><a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/18809406/118f9c48-8283-11e6-8f10-d8291517a497.png"><img src="https://cloud.githubusercontent.com/assets/13649199/18809406/118f9c48-8283-11e6-8f10-d8291517a497.png" alt="image" style="max-width:100%;"></a></p>
    <blockquote>
        <p>Проверьте, что у user в Privileges есть возможность авторизации (особенно для pgAdmin4)</p>
    </blockquote>
    <p>или в UNIX командной строке:</p>
    <pre><code>sudo -u postgres psql
CREATE DATABASE topjava;
CREATE USER "user" WITH password 'password';
GRANT ALL PRIVILEGES ON DATABASE topjava TO "user";
</code></pre>
    <ul>
        <li><a href="http://alexander.holbreich.org/2013/03/nosql-or-rdbms/" rel="nofollow">NoSQL or RDBMS.</a> <a href="http://habrahabr.ru/post/77909/" rel="nofollow">Обзор NoSQL систем</a>. <a href="http://blog.nahurst.com/visual-guide-to-nosql-systems" rel="nofollow">CAP</a></li>
        <li><a href="http://db-engines.com/en/ranking" rel="nofollow">DB-Engines Ranking</a></li>
        <li><a href="http://ru.wikipedia.org/wiki/Java_Database_Connectivity" rel="nofollow">JDBC</a></li>
        <li>Обзор Java persistence solution без ORM: <a href="http://commons.apache.org/proper/commons-dbutils/" rel="nofollow">commons-dbutils</a>,
            <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#jdbc" rel="nofollow">Spring JdbcTemplate</a>,
            <a href="http://en.wikipedia.org/wiki/MyBatis" rel="nofollow">MyBatis</a>, <a href="http://www.jdbi.org/" rel="nofollow">JDBI</a>, <a href="http://www.jooq.org/" rel="nofollow">jOOQ</a>
        </li>
        <li>
            Основы:
            <ul>
                <li><a href="https://ru.wikipedia.org/wiki/Реляционная_СУБД" rel="nofollow">Реляционная СУБД</a></li>
                <li><a href="http://habrahabr.ru/post/103021/" rel="nofollow">Реляционные базы</a></li>
                <li><a href="https://habr.com/ru/post/193136/" rel="nofollow">Руководство по проектированию реляционных баз данных</a></li>
                <li><a href="https://www.youtube.com/playlist?list=PLIU76b8Cjem5qdMQLXiIwGLTLyUHkTqi2" rel="nofollow">Уроки по JDBC</a></li>
                <li><a href="http://postgresguide.com/" rel="nofollow">Postgres Guide</a></li>
                <li><a href="http://www.postgresqltutorial.com" rel="nofollow">PostgreSQL Tutorial</a></li>
                <li><a href="http://java-course.ru/begin/database01/" rel="nofollow">Базы данных на Java</a></li>
                <li><a href="http://java-course.ru/begin/database02/" rel="nofollow">Возможности JDBC — второй этап</a></li>
            </ul>
        </li>
        <li>
            Дополнительно:
            <ul>
                <li><a href="https://postgrespro.ru/docs/postgrespro" rel="nofollow">Документация к PostgreSQL</a></li>
                <li><a href="https://postgrespro.ru/education/books" rel="nofollow">Книги по PostgreSQL</a></li>
            </ul>
        </li>
    </ul>
    <h3>
        <a id="user-content--9-настройка-database-в-idea" class="anchor" aria-hidden="true" href="#-9-настройка-database-в-idea">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 9. <a href="https://drive.google.com/open?id=0B9Ye2auQ_NsFQWtHYU1qTDlMWVE" rel="nofollow">Настройка Database в IDEA.</a>
    </h3>
    <blockquote>
        <ul>
            <li>Креденшелы к базе Heroku (AWS)  находятся вверху <code>postgres.properties</code>.</li>
            <li>В новом PostgreSQL для коннекта с базой на Heroku (AWS) добавился параметр <code>sslmode=require</code>.</li>
            <li>В новой IDEA еще необходимо настроить импортируемые схемы (<code>Schemas -&gt; Current database</code>)</li>
        </ul>
    </blockquote>
    <p><a target="_blank" rel="noopener noreferrer" href="https://user-images.githubusercontent.com/13649199/60019737-40a08300-9697-11e9-90cf-35675e903a3f.png"><img src="https://user-images.githubusercontent.com/13649199/60019737-40a08300-9697-11e9-90cf-35675e903a3f.png" alt="image" style="max-width:100%;"></a></p>
    <h4>
        <a id="user-content-apply-3_11_add_postgresqlpatch" class="anchor" aria-hidden="true" href="#apply-3_11_add_postgresqlpatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Apply 3_11_add_postgresql.patch
    </h4>
    <ul>
        <li><a href="http://habrahabr.ru/company/JetBrains/blog/204064/" rel="nofollow">Настройка Database в IDEA</a> и запуск SQL.</li>
    </ul>
    <h3>
        <a id="user-content--10-скрипты-инициализации-базы-spring-jdbc-template" class="anchor" aria-hidden="true" href="#-10-скрипты-инициализации-базы-spring-jdbc-template">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 10. <a href="https://drive.google.com/open?id=0B9Ye2auQ_NsFMGNWUXhaVzdlU0k" rel="nofollow">Скрипты инициализации базы. Spring Jdbc Template.</a>
    </h3>
    <h4>
        <a id="user-content-apply-3_12_db_implementationpatch" class="anchor" aria-hidden="true" href="#apply-3_12_db_implementationpatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Apply 3_12_db_implementation.patch
    </h4>
    <blockquote>
        <ul>
            <li>
                в <code>JdbcUserRepository</code>
                <ul>
                    <li>в <code>getByEmail()</code> заменил <code>queryForObject()</code> на <code>query()</code>. Загляните в код: <code>queryForObject</code> бросает <code>EmptyResultDataAccessException</code> вместо нужного нам <code>null</code>.</li>
                    <li>в <code>save()</code> добавил проверку на несуществующей в базе <code>User.id</code></li>
                </ul>
            </li>
            <li>в классе <code>JdbcTemplate</code> есть настройки (<code>queryTimeout/ skipResultsProcessing/ skipUndeclaredResults</code>) уровня приложения (если они будут меняться, то, скорее всего, везде в приложении).
                Мы можем дополнительно сконфигурировать его в <code>spring-db.xml</code> и использовать в конструкторах <code>NamedParameterJdbcTemplate</code> и в <code>SimpleJdbcInsert</code> вместо <code>dataSource</code>.
            </li>
        </ul>
    </blockquote>
    <p>Если IDEA не видит таблицы/поля, попробуйте поднять флажок <code>Introspect using JDBC metadata</code> (у меня все без него работает):</p>
    <p><a target="_blank" rel="noopener noreferrer" href="https://user-images.githubusercontent.com/13649199/96332049-9f4af680-106a-11eb-996e-61352d14495a.png"><img src="https://user-images.githubusercontent.com/13649199/96332049-9f4af680-106a-11eb-996e-61352d14495a.png" alt="image" style="max-width:100%;"></a></p>
    <p><a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672858/9cd58692-e6e7-11e5-905d-c295d2a456f1.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672858/9cd58692-e6e7-11e5-905d-c295d2a456f1.png" alt="question" style="max-width:100%;"></a> <strong>Вопрос: почему отображение еды не работает?</strong></p>
    <ul>
        <li>Подключение <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#jdbc" rel="nofollow">Spring Jdbc</a>.</li>
        <li>Конфигурирование DataSource. <a href="http://www.mkyong.com/spring/spring-propertyplaceholderconfigurer-example/" rel="nofollow">Property Placeholder</a></li>
        <li>Интеграция <code>JdbcUserRepository</code> с DB: <a href="https://github.com/JavaOPs/topjava/wiki/IDEA">IDEA Wiki</a> -&gt; Добавить поддержку DB в JDBC</li>
    </ul>
    <blockquote>
        <p>Проверьте, что в контекст Spring проекта включены оба файла конфигурации</p>
    </blockquote>
    <p><a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/24730713/eb21456a-1a6d-11e7-997c-fb4ad728ba45.png"><img src="https://cloud.githubusercontent.com/assets/13649199/24730713/eb21456a-1a6d-11e7-997c-fb4ad728ba45.png" alt="image" style="max-width:100%;"></a></p>
    <h3>
        <a id="user-content--11-тестирование-userservice-через-assertj" class="anchor" aria-hidden="true" href="#-11-тестирование-userservice-через-assertj">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 11. <a href="https://drive.google.com/open?id=1SPMkWMYPvpk9i0TA7ioa-9Sn1EGBtClD" rel="nofollow">Тестирование UserService через AssertJ.</a>
    </h3>
    <h4>
        <a id="user-content-apply-3_13_test_userservicepatch" class="anchor" aria-hidden="true" href="#apply-3_13_test_userservicepatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Apply 3_13_test_UserService.patch
    </h4>
    <blockquote>
        <ul>
            <li>В конструктор <code>User</code> внес <code>registered</code> и делаю копию <code>roles</code>, чтобы роли нельзя было изменить после инициализации.</li>
            <li>В тестах <code>delete</code> и <code>create</code> проверяю результат напрямую (не через <code>getAll</code>)</li>
            <li>В <code>UserTestData</code> добавил вспомогательные <code>getNew()</code> и <code>getUpdated()</code></li>
        </ul>
    </blockquote>
    <ul>
        <li><a href="http://www.vogella.com/tutorials/AssertJ/article.html" rel="nofollow">Tutorial: testing with AssertJ</a></li>
        <li><a href="https://docs.spring.io/spring/docs/4.3.x/spring-framework-reference/htmlsingle/#integration-testing-annotations-spring" rel="nofollow">Spring Testing Annotations</a></li>
        <li><a href="https://stackoverflow.com/questions/5031614/548473" rel="nofollow">The JPA hashCode() / equals() dilemma</a></li>
        <li><a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-model-pojo-equalshashcode" rel="nofollow">Hibernate: implementing equals() and hashCode()</a></li>
        <li><a href="https://stackoverflow.com/questions/17949752/548473" rel="nofollow">Junit Matcher for comparators</a></li>
        <li><a href="http://joel-costigliola.github.io/assertj/assertj-core-features-highlight.html#custom-comparison-strategy" rel="nofollow">AssertJ custom comparison strategy</a>. <a href="http://joel-costigliola.github.io/assertj/assertj-core-features-highlight.html#field-by-field-comparison" rel="nofollow">AssertJ field by field comparisons</a></li>
    </ul>
    <h3>
        <a id="user-content--12-логирование-тестов" class="anchor" aria-hidden="true" href="#-12-логирование-тестов">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672715/06dbc6ce-e6e7-11e5-81a9-04fbddb9e488.png" alt="video" style="max-width:100%;"></a> 12. <a href="https://drive.google.com/open?id=0B9Ye2auQ_NsFVmZaSm9UMktXUnc" rel="nofollow">Логирование тестов.</a>
    </h3>
    <h4>
        <a id="user-content-apply-3_14_test_loggingpatch" class="anchor" aria-hidden="true" href="#apply-3_14_test_loggingpatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Apply 3_14_test_logging.patch
    </h4>
    <blockquote>
        <ul>
            <li>Новый PostgreSQL JDBC Driver <a href="https://github.com/pgjdbc/pgjdbc#changelog">логирует через java.util.logging</a>.  <a href="http://stackoverflow.com/a/43242620/548473" rel="nofollow">Направил логирование в SLF4J</a></li>
            <li>Поменял формат вывода. См. <a href="https://logback.qos.ch/manual/layouts.html" rel="nofollow">Logback Layouts</a></li>
        </ul>
    </blockquote>
    <ul>
        <li>Ресурсы, которые кладутся в classpath, maven при сборке берет из определенных каталогов <code>resources</code> (<a href="https://maven.apache.org/guides/introduction/introduction-to-the-standard-directory-layout.html" rel="nofollow">Introduction to the Standard Directory Layout</a>). Их можно настраивать через <a href="https://maven.apache.org/plugins/maven-resources-plugin/examples/resource-directory.html" rel="nofollow">maven-resources-plugin</a>, меняем в проекте Masterjava.</li>
    </ul>
    <h4>
        <a id="user-content-apply-3_15_fix_servletpatch" class="anchor" aria-hidden="true" href="#apply-3_15_fix_servletpatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Apply 3_15_fix_servlet.patch
    </h4>
    <p><strong>Приложение перестало работать, тк. для репозитория мы используем заглушку <code>JdbcMealRepository</code></strong></p>
    <h4>
        <a id="user-content-apply-3_16_fix_junitpatch" class="anchor" aria-hidden="true" href="#apply-3_16_fix_junitpatch">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Apply <a href="https://drive.google.com/file/d/15FGxDjfiuwdkjc7miOibnB7570mUr9-i" rel="nofollow">3_16_fix_junit.patch</a>
    </h4>
    <blockquote>
        <p>При выполнении функционала <code>create/update</code> объекты могут измениться, и мы не можем считать их эталонными. Поэтому при сравнении мы создаем эталон еще раз.</p>
    </blockquote>
    <h2>
        <a id="user-content--ваши-вопросы" class="anchor" aria-hidden="true" href="#-ваши-вопросы">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672858/9cd58692-e6e7-11e5-905d-c295d2a456f1.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672858/9cd58692-e6e7-11e5-905d-c295d2a456f1.png" alt="question" style="max-width:100%;"></a> Ваши вопросы
    </h2>
    <blockquote>
        <p>Что такое REST?</p>
    </blockquote>
    <p>Коротко посмотрите тут: <a href="http://spring-projects.ru/understanding/rest/" rel="nofollow">понимание REST</a>. Более подробно мы будем разбирать этот архитектурный стиль API на 7-ом занятии.</p>
    <blockquote>
        <p>Какая разница между @BeforeClass and @Before?</p>
    </blockquote>
    <p><code>@BeforeClass</code> выполняется один раз после загрузки класса (поэтому метод может быть только статический), <code>@Before</code> перед каждым тестом.
        Также: для чистоты тестов экземпляр тестового класса <a href="http://stackoverflow.com/questions/6094081/548473" rel="nofollow">пересоздается перед каждым тестом</a>
    </p>
    <blockquote>
        <p>Тесты в классе в каком-то определенном порядке выполняются ("сверху вниз" например)?</p>
    </blockquote>
    <p>Порядок по умолчанию неопределен, каждый тест должен быть автономен и не зависеть от других. <a href="http://stackoverflow.com/questions/3693626/548473" rel="nofollow">См. также "How to run test methods in specific order in JUnit4?"</a></p>
    <blockquote>
        <p>Обязательно ли разворачивать postgreSQL?</p>
    </blockquote>
    <p>Желательно: хорошая и надежная ДБ:) Если совсем не хочется - можно работать со своей любимой RDBMS (поправить <code>initDB.sql</code>) или работать c postgresql в heroku (креденшелы к нему есть сверху в <code>postgres.properties</code>). На следующем уроке добавим HSQLDB, она не требует установки.</p>
    <blockquote>
        <p>Зачем начали индексацию с 100000?</p>
    </blockquote>
    <p>Тут нет "как принято". Так удобно вставлять в базу (если будет потребность) записи вручную не мешая счетчику.</p>
    <blockquote>
        <p>Из 5-го видео - "Логика в базе - большое зло". Можно чуть поподробней об этом?</p>
    </blockquote>
    <ul>
        <li>Есть успешные проекты с логикой в базе. Те все относительно.</li>
        <li>Логика в базе - это процедуры и триггеры. Нет никакого ООП, переиспользовать код достаточно сложно, никагого рефакторинга, поиска по коду и других плюшек IDE. Нельзя делать всякие вещи типа кэширования, хранения в сессии - это все для логики на стороне java. Например json можно напрямую отдать в процедуру и там парсить и вставлять в таблицы или наоборот - собирать из таблиц и возвращать.
            А затем потребуется некоторая логика на стороне приложения и все равно придется этот json дополнительно парсить в java.
            Я на таком проекте делал специальную миграцию, чтобы процедуры мигрировать не как sql-скрипты, а каждую процедуру хранить как класс с историей изменений. Если логика: триггеры и простые процедуры записи-чтения, которые не требуют переиспользования кода или
            проект небольшой - это допустимо, иначе проект становится трудно поддерживать. Также иногда используют <a href="http://postgresql.men/gruber/ch20.html" rel="nofollow">View</a> для разграничения доступа. Например, для финансовых систем, таблицы проводок доступны только  для админ учеток, а View просто не дадут увидеть (тем более изменить) данные обычному оператору на уровне СУБД.
        </li>
    </ul>
    <blockquote>
        <p>У JUnit есть ассерты и у спринга тоже. Можно ли обойтись без JUnit?</p>
    </blockquote>
    <p>Предусловия и JUnit-тесты совершенно разные вещи. Один другого не заменит. У нас будут предусловия в следующем уроке.</p>
    <blockquote>
        <p>Я так понял, что при работе с небольшими записями, VARCHAR быстрее, чем TEXT. Наши записи будут небольшими (255). Почему вы приняли решение перейти на TEXT?</p>
    </blockquote>
    <p>В отличие от MySql, в Postgres  <a href="https://stackoverflow.com/questions/4848964/548473" rel="nofollow">VARCHAR и TEXT - тоже самое</a></p>
    <blockquote>
        <p>Зачем при создании таблицы мы создаем <code>CREATE UNIQUE INDEX</code> и <code>CREATE INDEX</code>. При каких запросах он будет использоваться?</p>
    </blockquote>
    <p>UNIQUE индекс нужен для обеспечения уникальности, DB не даст сделать одинаковый индекс. Индексы используется для скорости выполнения запросов. Обычно они используются, когда в запросе есть условия, на которые сделан индекс. Узнать по конкретному запросу можно  запросив план запроса: см. <a href="https://habrahabr.ru/post/203320" rel="nofollow">Оптимизация запросов. Основы EXPLAIN в PostgreSQL</a>. На измерение производительности с индексами посмотрим в следующем уроке.</p>
    <blockquote>
        <p>А это нормально, что у нас в базе у meals есть userId, а в классе - нет?</p>
    </blockquote>
    <p>Ненормально, когда в приложении есть "лишний" код, который не используется. Для ORM он нам понадобится - добавим <code>Meal.user</code>.</p>
    <blockquote>
        <p>Почему мы делаем один sequence на разные таблицы?</p>
    </blockquote>
    <p>Мы будем использовать Hibernate. По умолчанию он делает глобальный sequence на все таблицы. В этом подходе есть <a href="http://stackoverflow.com/questions/1536479/548473" rel="nofollow">как плюсы, так и минусы</a>.</p>
    <blockquote>
        <p>Каким образом попадают в тесты классы, расположенные в каталоге <code>test</code>, если в конфигурации спринга нет указание на ее сканирование?</p>
    </blockquote>
    <p>Сканируются не папки, а пакеты. Обычно тесты классов располагают в том же самом пакете каталога <code>test</code>. Таким образом тесты могут видеть поля классов <code>main</code> с видимостью по умолчанию (внутри пакета). При этом классы <code>test</code> видят <code>main</code>, а наоборот нет. Когда приложение деплоится, в коде тестов быть не должно!</p>
    <h2>
        <a id="user-content--домашнее-задание-hw03" class="anchor" aria-hidden="true" href="#-домашнее-задание-hw03">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672719/09593080-e6e7-11e5-81d1-5cb629c438ca.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672719/09593080-e6e7-11e5-81d1-5cb629c438ca.png" alt="hw" style="max-width:100%;"></a> Домашнее задание HW03
    </h2>
    <ul>
        <li>1 Понять, почему перестали работать <code>SpringMain, InMemoryAdminRestControllerTest, InMemoryAdminRestControllerSpringTest</code>. Чиним в Optional.</li>
        <li>
            2 Дополнить скрипты создания и инициализации базы таблицей MEALS. Запустить скрипты на вашу базу (через Run). Порядок таблиц при DROP и DELETE важен, если они связаны внешними ключами (foreign key, fk). Проверьте, что ваши скрипты работают.
            <ul>
                <li>2.1 Сделать индексы к таблице <code>meals</code>: запретить создавать у одного и того-же юзера еду с одинаковой dateTime.
                    Индекс на pk (id) postgres создает автоматически: <a href="http://stackoverflow.com/questions/970562/548473" rel="nofollow">Postgres and Indexes on Foreign Keys and Primary Keys</a>
                </li>
                <li><a href="https://ru.wikipedia.org/wiki/%D0%98%D0%BD%D0%B4%D0%B5%D0%BA%D1%81_(%D0%B1%D0%B0%D0%B7%D1%8B_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85)" rel="nofollow">Индекс_базы_данных</a></li>
                <li><a href="https://postgrespro.ru/docs/postgresql/10/indexes-intro" rel="nofollow">PostgreSQL: индексы</a></li>
                <li><a href="http://postgresguide.com/performance/indexes.html" rel="nofollow">Postgres Guide: Indexes</a></li>
                <li><a href="https://habrahabr.ru/post/203320/" rel="nofollow">Оптимизация запросов. Основы EXPLAIN в PostgreSQL</a></li>
                <li><a href="https://habrahabr.ru/post/203386/" rel="nofollow">Оптимизация запросов. Часть 2</a></li>
                <li><a href="https://habrahabr.ru/post/203484/" rel="nofollow">Оптимизация запросов. Часть 3</a></li>
            </ul>
        </li>
    </ul>
    <blockquote>
        <p><a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672858/9cd58692-e6e7-11e5-905d-c295d2a456f1.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672858/9cd58692-e6e7-11e5-905d-c295d2a456f1.png" alt="question" style="max-width:100%;"></a> Как правильно придумать индекс для базы? Указать в нем все поля, комбинация которых создает по смыслу уникальную запись, или какие-то еще есть условия?</p>
    </blockquote>
    <p>Индекс нужно делать по тем полям, по которым будут искаться записи (участвуют в WHERE, ORDER BY). Уникальность - совсем необязательное условие. Индексы ускоряют поиск по определенным полям таблицы. Они не бесплатные (хранятся в памяти, замедляется вставка), поэтому на всякий случай их делать не надо. Также не строят индексы на колонки с малым процентом уникальности (например поле "М/Ж"). Поля индекса НЕ КОММУТАТИВНЫ и порядок полей в описании индекса НЕОБХОДИМО соблюдать (в силу использования B-деревьев и их производных как поисковый механизм индекса). При построении плана запроса EXPLAIN учитывается количество записей в базе, поэтому вместо индексного поиска (Index Scan) база может выбрать последовательный (Seq Scan). Проверить, работают ли индексы можно <a href="http://stackoverflow.com/questions/14554302/548473" rel="nofollow">отключив Seq Scan</a>. Также см. <a href="https://dba.stackexchange.com/a/27493/3684" rel="nofollow">Queries on the first field of composite index</a></p>
    <ul>
        <li>
            3 Реализовать через Spring JDBC Template <code>JdbcMealRepository</code>
            <ul>
                <li>3.1. сделать каждый метод за один SQL запрос</li>
                <li>3.2. <code>userId</code> в класс <code>Meal</code> вставлять НЕ надо, делаем <em>foreign key</em> только в базе (для UI и REST это лишние данные, userId это id залогиненного пользователя)</li>
                <li>3.3. <code>JbdcTemplate</code> работает через сеттеры. Вместе с конструктором по умолчанию их нужно добавить в <code>Meal</code></li>
                <li>3.4. Список еды должен быть отсортирован (тогда мы его сможем сравнивать с тестовыми данными). Кроме того это требуется для UI и API: последняя еда наверху.</li>
            </ul>
        </li>
        <li>4 Проверить работу MealServlet, запустив приложение</li>
    </ul>
    <h3>
        <a id="user-content-optional" class="anchor" aria-hidden="true" href="#optional">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Optional
    </h3>
    <ul>
        <li>5 Сделать <code>MealServiceTest</code> из <code>MealService</code> и реализовать тесты для <code>JdbcMealRepository</code>.</li>
    </ul>
    <blockquote>
        <p>По <code>Ctrl+Shift+T</code> (выбрать JUnit4) можно создать тест для конкретного класса, выбрав для него нужные методы. Тестовый класс создастся в папке <code>test</code> в том же пакете, что и тестируемый.</p>
    </blockquote>
    <ul>
        <li>5.1 Сделать тестовые данные <code>MealTestData</code> (точно такие же, как вставляем в <code>populateDB.sql</code>).</li>
        <li>5.2 Сделать тесты на чужую еду (delete, get, update) с тем, чтобы получить <code>NotFoundException</code> и <code>duplicateDateTimeCreate</code>, аналогичный <code>duplicateMailCreate</code>.</li>
        <li>6 Починить <code>SpringMain, InMemory*Test</code>. <strong>InMemory тесты должны использовать реализацию в памяти</strong></li>
    </ul>
    <hr>
    <h3>
        <a id="user-content-итоги-занятия-после-выполнения-дз" class="anchor" aria-hidden="true" href="#итоги-занятия-после-выполнения-дз">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        Итоги занятия после выполнения ДЗ:
    </h3>
    <p>Наше приложение стало хранить данные в PostgreSQL.<br>
        Добавили в приложение JUnit тесты.<br>
        Разделили Spring контекст для работы с памятью и с БД.
    </p>
    <hr>
    <h3>
        <a id="user-content--решение-проблем" class="anchor" aria-hidden="true" href="#-решение-проблем">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672935/ef09ec1e-e6e7-11e5-9f79-d1641c05cbe6.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672935/ef09ec1e-e6e7-11e5-9f79-d1641c05cbe6.png" alt="error" style="max-width:100%;"></a> Решение проблем
    </h3>
    <blockquote>
        <p>Из каталога <code>main</code> не видятся классы/ресурсы в <code>test</code></p>
    </blockquote>
    <p>Все что находится в <code>test</code> используется только для тестов и недоступно в основном коде.</p>
    <blockquote>
        <p>Из <code>IDEA</code> не видятся ресурсы в каталоге <code>test</code></p>
    </blockquote>
    <ul>
        <li>Сделайте Reimport All в Maven окне</li>
    </ul>
    <p><a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/18831806/7e43bedc-83f0-11e6-97db-67d4e1a7599f.png"><img src="https://cloud.githubusercontent.com/assets/13649199/18831806/7e43bedc-83f0-11e6-97db-67d4e1a7599f.png" alt="image" style="max-width:100%;"></a></p>
    <blockquote>
        <p>В UserService и MealService подчеркнуты красным repository, ошибка: Could not autowire. There is more than one bean of 'MealRepository' type.</p>
    </blockquote>
    <ul>
        <li>Spring test контекст не надо включать в Spring Facets проекта, там должны быть только <code>spring-app.xml</code> и <code>spring-db.xml</code>. Для тестовых контекстов поставьте чекбокс <code>Check test files</code> в Inspections.</li>
    </ul>
    <p><a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/18831817/8a858f22-83f0-11e6-837e-bf5317b33b3a.png"><img src="https://cloud.githubusercontent.com/assets/13649199/18831817/8a858f22-83f0-11e6-837e-bf5317b33b3a.png" alt="image" style="max-width:100%;"></a></p>
    <h3>
        <a id="user-content--типичные-ошибки-и-подсказки-по-реализации" class="anchor" aria-hidden="true" href="#-типичные-ошибки-и-подсказки-по-реализации">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/13649199/13672935/ef09ec1e-e6e7-11e5-9f79-d1641c05cbe6.png"><img src="https://cloud.githubusercontent.com/assets/13649199/13672935/ef09ec1e-e6e7-11e5-9f79-d1641c05cbe6.png" alt="error" style="max-width:100%;"></a> Типичные ошибки и подсказки по реализации
    </h3>
    <ul>
        <li>1: В <code>MealTestData</code> еду делайте константами. Не надо <code>Map</code> конструкций!</li>
        <li>2: SQL case-insensitive, <strong>не надо писать в стиле Camel</strong>. В POSTGRES возможны case-sensitive значения, их надо в кавычки заключать (обычно не делают).</li>
        <li>3: ЕЩЕ РАЗ: <code>InMemory</code> тесты должны идти на <code>InMemory</code> репозитории</li>
        <li>4: <strong>Проверьте, что возвращает <code>JdbcMealRepository</code> при обновлении чужой еды</strong></li>
        <li>5: В реализации <code>JdbcMealRepository</code> одним SQL запросом используйте возвращаемое <code>update</code> значение <code>the number of rows affected</code></li>
        <li>6: При тестировании не портите эталонные тестовые объекты из <code>MealTestData</code></li>
        <li>7: Проверьте, что все, что относится к тестам, находится в каталоге <code>test</code> (не попадает в сборку проекта)</li>
        <li>8: <strong>Еще раз: в тестах нельзя сравнивать объекты через <code>JUnit Assert</code> и <code>assertThat().isEqualTo</code> - сравнение будет происходить через <code>AbstractBaseEntity.equals</code>, который сравнивает объекты только по <code>id</code>. Мы не можем переопределять <code>equals</code> для объектов модели, тк будем использовать JPA (см. <a href="https://stackoverflow.com/questions/5031614/548473" rel="nofollow">The JPA hashCode() / equals() dilemma</a>)</strong></li>
        <li>9: НЕ делайте склейку SQL запросов вручную из параметров, только через <code>jdbcTemplate</code> параметры! См. <a href="https://ru.wikipedia.org/wiki/%D0%92%D0%BD%D0%B5%D0%B4%D1%80%D0%B5%D0%BD%D0%B8%D0%B5_SQL-%D0%BA%D0%BE%D0%B4%D0%B0" rel="nofollow">Внедрение_SQL-кода</a></li>
        <li>10: Напомню: <code>BeanPropertyRowMapper</code> работает через отражение. Ему нужны геттеры/сеттеры и имена полей должны "совпадать" с колонками <code>ResultSet</code> (Column values are mapped based on matching the column name as obtained from result set metadata to public setters for the corresponding properties. The names are matched either directly or by transforming a name separating the parts with underscores to the same name using "camel" case).</li>
        <li>11: Для разделения тестов InMemory и Jdbc можно использовать разные Spring context. В том числе переопределять контест для тестов в <code>src\test\resources</code></li>
        <li>12: Обязательно протестируйте в <code>MealServiceTest</code> нормальное поведение методов (по аналогии с <code>UserServiceTest</code>)</li>
    </ul>
</article>